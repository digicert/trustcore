/*
 * protobuf_test.c
 *
 * Protobuf Test
 *
 * Copyright 2025 DigiCert Project Authors. All Rights Reserved.
 *
 * DigiCert® TrustCore and TrustEdge are licensed under a dual-license model:
 * - **Open Source License**: GNU AGPL v3. See: https://github.com/digicert/trustcore-test/blob/main/LICENSE
 * - **Commercial License**: Available under DigiCert’s Master Services Agreement. See: https://github.com/digicert/trustcore-test/blob/main/LICENSE_COMMERCIAL.txt
 *   or https://www.digicert.com/master-services-agreement/
 *
 * *For commercial licensing, contact DigiCert at sales@digicert.com.*
 *
 */

#include "../protobuf.c"
#include "../mrtos.h"
#include "../datetime.h"


#include "../../../unit_tests/unittest.h"
#include "../../../unit_tests/unittest_utils.h"

#include <stdio.h>

/*
Raw decode
==========
1: 1725474525665
3: 0
4: "DeviceTM_Certificate_Specification_Response"
5: "{\"policyService\":\"CertificatePolicy\",\"deviceId\":\"f3d4fa9f-6e52-4e41-b512-1850a3f50c4b\",\"accountId\":\"998150c5-2443-4abf-8edb-a7e505b7bdbd\",\"mode\":\"certificate_specification\",\"certificatePolicyId\":\"IOT_de6909a9-c467-4bb2-abc3-6db63dd0e54d\",\"deviceGroupId\":\"1228a72f-5af7-4f36-ad78-1aaa1f22620e\",\"certificateSpecification\":{\"version\":\"2\",\"certificateRequestFormat\":{\"format\":\"PKCS10\"},\"keyCertAttributes\":{\"keyAlgorithm\":[\"RSA+1024\",\"RSA+2048\",\"RSA+3072\",\"RSA+4096\",\"ECDSA+P256\",\"ECDSA+P384\",\"ECDSA+P521\",\"EDDSA+Ed25519\"],\"source\":[\"SW\"]},\"csrAttributes\":{\"fields\":[{\"id\":\"signature_algorithm\",\"defaultValue\":[\"sha1WithRSA\",\"sha256WithRSA\",\"sha384WithRSA\",\"sha512WithRSA\",\"sha3_256WithRSA\",\"sha3_384WithRSA\",\"sha3_512WithRSA\",\"sha256WithRSAPSS\",\"sha384WithRSAPSS\",\"sha512WithRSAPSS\"]},{\"id\":\"subject.common_name\",\"defaultValue\":[\"CN-00:00:00:00:00-Default\"],\"evalValue\":\"CN-##mac_address##-Eval\"},{\"id\":\"subject.organization_name\",\"defaultValue\":[\"undefined\"],\"evalValue\":\"ON-##operating_system##-Eval\"},{\"id\":\"subject.organization_unit\",\"defaultValue\":[\"OU-Default\"],\"evalValue\":\"undefined\"}]}}}"

Message decode
==============
timestamp: 1725474525665
seq: 0
uuid: "DeviceTM_Certificate_Specification_Response"
body: "{\"policyService\":\"CertificatePolicy\",\"deviceId\":\"f3d4fa9f-6e52-4e41-b512-1850a3f50c4b\",\"accountId\":\"998150c5-2443-4abf-8edb-a7e505b7bdbd\",\"mode\":\"certificate_specification\",\"certificatePolicyId\":\"IOT_de6909a9-c467-4bb2-abc3-6db63dd0e54d\",\"deviceGroupId\":\"1228a72f-5af7-4f36-ad78-1aaa1f22620e\",\"certificateSpecification\":{\"version\":\"2\",\"certificateRequestFormat\":{\"format\":\"PKCS10\"},\"keyCertAttributes\":{\"keyAlgorithm\":[\"RSA+1024\",\"RSA+2048\",\"RSA+3072\",\"RSA+4096\",\"ECDSA+P256\",\"ECDSA+P384\",\"ECDSA+P521\",\"EDDSA+Ed25519\"],\"source\":[\"SW\"]},\"csrAttributes\":{\"fields\":[{\"id\":\"signature_algorithm\",\"defaultValue\":[\"sha1WithRSA\",\"sha256WithRSA\",\"sha384WithRSA\",\"sha512WithRSA\",\"sha3_256WithRSA\",\"sha3_384WithRSA\",\"sha3_512WithRSA\",\"sha256WithRSAPSS\",\"sha384WithRSAPSS\",\"sha512WithRSAPSS\"]},{\"id\":\"subject.common_name\",\"defaultValue\":[\"CN-00:00:00:00:00-Default\"],\"evalValue\":\"CN-##mac_address##-Eval\"},{\"id\":\"subject.organization_name\",\"defaultValue\":[\"undefined\"],\"evalValue\":\"ON-##operating_system##-Eval\"},{\"id\":\"subject.organization_unit\",\"defaultValue\":[\"OU-Default\"],\"evalValue\":\"undefined\"}]}}}"
*/
unsigned char cert_spec_pb[] = {
  0x08, 0xe1, 0xa3, 0xaf, 0xf2, 0x9b, 0x32, 0x18, 0x00, 0x22, 0x2b, 0x44,
  0x65, 0x76, 0x69, 0x63, 0x65, 0x54, 0x4d, 0x5f, 0x43, 0x65, 0x72, 0x74,
  0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x65, 0x5f, 0x53, 0x70, 0x65, 0x63,
  0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x5f, 0x52, 0x65,
  0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x2a, 0xc5, 0x08, 0x7b, 0x22, 0x70,
  0x6f, 0x6c, 0x69, 0x63, 0x79, 0x53, 0x65, 0x72, 0x76, 0x69, 0x63, 0x65,
  0x22, 0x3a, 0x22, 0x43, 0x65, 0x72, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61,
  0x74, 0x65, 0x50, 0x6f, 0x6c, 0x69, 0x63, 0x79, 0x22, 0x2c, 0x22, 0x64,
  0x65, 0x76, 0x69, 0x63, 0x65, 0x49, 0x64, 0x22, 0x3a, 0x22, 0x66, 0x33,
  0x64, 0x34, 0x66, 0x61, 0x39, 0x66, 0x2d, 0x36, 0x65, 0x35, 0x32, 0x2d,
  0x34, 0x65, 0x34, 0x31, 0x2d, 0x62, 0x35, 0x31, 0x32, 0x2d, 0x31, 0x38,
  0x35, 0x30, 0x61, 0x33, 0x66, 0x35, 0x30, 0x63, 0x34, 0x62, 0x22, 0x2c,
  0x22, 0x61, 0x63, 0x63, 0x6f, 0x75, 0x6e, 0x74, 0x49, 0x64, 0x22, 0x3a,
  0x22, 0x39, 0x39, 0x38, 0x31, 0x35, 0x30, 0x63, 0x35, 0x2d, 0x32, 0x34,
  0x34, 0x33, 0x2d, 0x34, 0x61, 0x62, 0x66, 0x2d, 0x38, 0x65, 0x64, 0x62,
  0x2d, 0x61, 0x37, 0x65, 0x35, 0x30, 0x35, 0x62, 0x37, 0x62, 0x64, 0x62,
  0x64, 0x22, 0x2c, 0x22, 0x6d, 0x6f, 0x64, 0x65, 0x22, 0x3a, 0x22, 0x63,
  0x65, 0x72, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x65, 0x5f, 0x73,
  0x70, 0x65, 0x63, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e,
  0x22, 0x2c, 0x22, 0x63, 0x65, 0x72, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61,
  0x74, 0x65, 0x50, 0x6f, 0x6c, 0x69, 0x63, 0x79, 0x49, 0x64, 0x22, 0x3a,
  0x22, 0x49, 0x4f, 0x54, 0x5f, 0x64, 0x65, 0x36, 0x39, 0x30, 0x39, 0x61,
  0x39, 0x2d, 0x63, 0x34, 0x36, 0x37, 0x2d, 0x34, 0x62, 0x62, 0x32, 0x2d,
  0x61, 0x62, 0x63, 0x33, 0x2d, 0x36, 0x64, 0x62, 0x36, 0x33, 0x64, 0x64,
  0x30, 0x65, 0x35, 0x34, 0x64, 0x22, 0x2c, 0x22, 0x64, 0x65, 0x76, 0x69,
  0x63, 0x65, 0x47, 0x72, 0x6f, 0x75, 0x70, 0x49, 0x64, 0x22, 0x3a, 0x22,
  0x31, 0x32, 0x32, 0x38, 0x61, 0x37, 0x32, 0x66, 0x2d, 0x35, 0x61, 0x66,
  0x37, 0x2d, 0x34, 0x66, 0x33, 0x36, 0x2d, 0x61, 0x64, 0x37, 0x38, 0x2d,
  0x31, 0x61, 0x61, 0x61, 0x31, 0x66, 0x32, 0x32, 0x36, 0x32, 0x30, 0x65,
  0x22, 0x2c, 0x22, 0x63, 0x65, 0x72, 0x74, 0x69, 0x66, 0x69, 0x63, 0x61,
  0x74, 0x65, 0x53, 0x70, 0x65, 0x63, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74,
  0x69, 0x6f, 0x6e, 0x22, 0x3a, 0x7b, 0x22, 0x76, 0x65, 0x72, 0x73, 0x69,
  0x6f, 0x6e, 0x22, 0x3a, 0x22, 0x32, 0x22, 0x2c, 0x22, 0x63, 0x65, 0x72,
  0x74, 0x69, 0x66, 0x69, 0x63, 0x61, 0x74, 0x65, 0x52, 0x65, 0x71, 0x75,
  0x65, 0x73, 0x74, 0x46, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x22, 0x3a, 0x7b,
  0x22, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x22, 0x3a, 0x22, 0x50, 0x4b,
  0x43, 0x53, 0x31, 0x30, 0x22, 0x7d, 0x2c, 0x22, 0x6b, 0x65, 0x79, 0x43,
  0x65, 0x72, 0x74, 0x41, 0x74, 0x74, 0x72, 0x69, 0x62, 0x75, 0x74, 0x65,
  0x73, 0x22, 0x3a, 0x7b, 0x22, 0x6b, 0x65, 0x79, 0x41, 0x6c, 0x67, 0x6f,
  0x72, 0x69, 0x74, 0x68, 0x6d, 0x22, 0x3a, 0x5b, 0x22, 0x52, 0x53, 0x41,
  0x2b, 0x31, 0x30, 0x32, 0x34, 0x22, 0x2c, 0x22, 0x52, 0x53, 0x41, 0x2b,
  0x32, 0x30, 0x34, 0x38, 0x22, 0x2c, 0x22, 0x52, 0x53, 0x41, 0x2b, 0x33,
  0x30, 0x37, 0x32, 0x22, 0x2c, 0x22, 0x52, 0x53, 0x41, 0x2b, 0x34, 0x30,
  0x39, 0x36, 0x22, 0x2c, 0x22, 0x45, 0x43, 0x44, 0x53, 0x41, 0x2b, 0x50,
  0x32, 0x35, 0x36, 0x22, 0x2c, 0x22, 0x45, 0x43, 0x44, 0x53, 0x41, 0x2b,
  0x50, 0x33, 0x38, 0x34, 0x22, 0x2c, 0x22, 0x45, 0x43, 0x44, 0x53, 0x41,
  0x2b, 0x50, 0x35, 0x32, 0x31, 0x22, 0x2c, 0x22, 0x45, 0x44, 0x44, 0x53,
  0x41, 0x2b, 0x45, 0x64, 0x32, 0x35, 0x35, 0x31, 0x39, 0x22, 0x5d, 0x2c,
  0x22, 0x73, 0x6f, 0x75, 0x72, 0x63, 0x65, 0x22, 0x3a, 0x5b, 0x22, 0x53,
  0x57, 0x22, 0x5d, 0x7d, 0x2c, 0x22, 0x63, 0x73, 0x72, 0x41, 0x74, 0x74,
  0x72, 0x69, 0x62, 0x75, 0x74, 0x65, 0x73, 0x22, 0x3a, 0x7b, 0x22, 0x66,
  0x69, 0x65, 0x6c, 0x64, 0x73, 0x22, 0x3a, 0x5b, 0x7b, 0x22, 0x69, 0x64,
  0x22, 0x3a, 0x22, 0x73, 0x69, 0x67, 0x6e, 0x61, 0x74, 0x75, 0x72, 0x65,
  0x5f, 0x61, 0x6c, 0x67, 0x6f, 0x72, 0x69, 0x74, 0x68, 0x6d, 0x22, 0x2c,
  0x22, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x56, 0x61, 0x6c, 0x75,
  0x65, 0x22, 0x3a, 0x5b, 0x22, 0x73, 0x68, 0x61, 0x31, 0x57, 0x69, 0x74,
  0x68, 0x52, 0x53, 0x41, 0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x32, 0x35,
  0x36, 0x57, 0x69, 0x74, 0x68, 0x52, 0x53, 0x41, 0x22, 0x2c, 0x22, 0x73,
  0x68, 0x61, 0x33, 0x38, 0x34, 0x57, 0x69, 0x74, 0x68, 0x52, 0x53, 0x41,
  0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x35, 0x31, 0x32, 0x57, 0x69, 0x74,
  0x68, 0x52, 0x53, 0x41, 0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x33, 0x5f,
  0x32, 0x35, 0x36, 0x57, 0x69, 0x74, 0x68, 0x52, 0x53, 0x41, 0x22, 0x2c,
  0x22, 0x73, 0x68, 0x61, 0x33, 0x5f, 0x33, 0x38, 0x34, 0x57, 0x69, 0x74,
  0x68, 0x52, 0x53, 0x41, 0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x33, 0x5f,
  0x35, 0x31, 0x32, 0x57, 0x69, 0x74, 0x68, 0x52, 0x53, 0x41, 0x22, 0x2c,
  0x22, 0x73, 0x68, 0x61, 0x32, 0x35, 0x36, 0x57, 0x69, 0x74, 0x68, 0x52,
  0x53, 0x41, 0x50, 0x53, 0x53, 0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x33,
  0x38, 0x34, 0x57, 0x69, 0x74, 0x68, 0x52, 0x53, 0x41, 0x50, 0x53, 0x53,
  0x22, 0x2c, 0x22, 0x73, 0x68, 0x61, 0x35, 0x31, 0x32, 0x57, 0x69, 0x74,
  0x68, 0x52, 0x53, 0x41, 0x50, 0x53, 0x53, 0x22, 0x5d, 0x7d, 0x2c, 0x7b,
  0x22, 0x69, 0x64, 0x22, 0x3a, 0x22, 0x73, 0x75, 0x62, 0x6a, 0x65, 0x63,
  0x74, 0x2e, 0x63, 0x6f, 0x6d, 0x6d, 0x6f, 0x6e, 0x5f, 0x6e, 0x61, 0x6d,
  0x65, 0x22, 0x2c, 0x22, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x56,
  0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a, 0x5b, 0x22, 0x43, 0x4e, 0x2d, 0x30,
  0x30, 0x3a, 0x30, 0x30, 0x3a, 0x30, 0x30, 0x3a, 0x30, 0x30, 0x3a, 0x30,
  0x30, 0x2d, 0x44, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x22, 0x5d, 0x2c,
  0x22, 0x65, 0x76, 0x61, 0x6c, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a,
  0x22, 0x43, 0x4e, 0x2d, 0x23, 0x23, 0x6d, 0x61, 0x63, 0x5f, 0x61, 0x64,
  0x64, 0x72, 0x65, 0x73, 0x73, 0x23, 0x23, 0x2d, 0x45, 0x76, 0x61, 0x6c,
  0x22, 0x7d, 0x2c, 0x7b, 0x22, 0x69, 0x64, 0x22, 0x3a, 0x22, 0x73, 0x75,
  0x62, 0x6a, 0x65, 0x63, 0x74, 0x2e, 0x6f, 0x72, 0x67, 0x61, 0x6e, 0x69,
  0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x5f, 0x6e, 0x61, 0x6d, 0x65, 0x22,
  0x2c, 0x22, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x56, 0x61, 0x6c,
  0x75, 0x65, 0x22, 0x3a, 0x5b, 0x22, 0x75, 0x6e, 0x64, 0x65, 0x66, 0x69,
  0x6e, 0x65, 0x64, 0x22, 0x5d, 0x2c, 0x22, 0x65, 0x76, 0x61, 0x6c, 0x56,
  0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a, 0x22, 0x4f, 0x4e, 0x2d, 0x23, 0x23,
  0x6f, 0x70, 0x65, 0x72, 0x61, 0x74, 0x69, 0x6e, 0x67, 0x5f, 0x73, 0x79,
  0x73, 0x74, 0x65, 0x6d, 0x23, 0x23, 0x2d, 0x45, 0x76, 0x61, 0x6c, 0x22,
  0x7d, 0x2c, 0x7b, 0x22, 0x69, 0x64, 0x22, 0x3a, 0x22, 0x73, 0x75, 0x62,
  0x6a, 0x65, 0x63, 0x74, 0x2e, 0x6f, 0x72, 0x67, 0x61, 0x6e, 0x69, 0x7a,
  0x61, 0x74, 0x69, 0x6f, 0x6e, 0x5f, 0x75, 0x6e, 0x69, 0x74, 0x22, 0x2c,
  0x22, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x56, 0x61, 0x6c, 0x75,
  0x65, 0x22, 0x3a, 0x5b, 0x22, 0x4f, 0x55, 0x2d, 0x44, 0x65, 0x66, 0x61,
  0x75, 0x6c, 0x74, 0x22, 0x5d, 0x2c, 0x22, 0x65, 0x76, 0x61, 0x6c, 0x56,
  0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a, 0x22, 0x75, 0x6e, 0x64, 0x65, 0x66,
  0x69, 0x6e, 0x65, 0x64, 0x22, 0x7d, 0x5d, 0x7d, 0x7d, 0x7d
};
unsigned int cert_spec_pb_len = 1150;

/*
Raw decode
==========
1: 1726590741665
2 {
  1: "metric1"
  3: 1726590741666
  4: 12
  15: "value1"
}
2 {
  1: "metric2"
  3: 1726590741666
  4: 12
  15: "value2"
}
3: 0
4: "DeviceTM_Pending_Policies"
5: "{\n    \"divisionId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2cc\",\n    \"accountId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2cd\",\n    \"deviceId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2ce\",\n    \"status\": \"OK\",\n    \"createdOn\": \"2012-04-23T18:25:43.000Z\",\n    \"updatedOn\": \"2012-04-23T18:25:43.000Z\",\n    \"pendingPolicies\": [\n        {\n            \"deviceGroupId\": \"128975\",\n            \"policyType\": \"CERTIFICATE\",\n            \"policyId\": \"294820113\",\n            \"priority\": 0\n        }\n    ]\n}\n"

Message decode
==============
timestamp: 1726590741665
metrics {
  name: "metric1"
  timestamp: 1726590741666
  datatype: 12
  string_value: "value1"
}
metrics {
  name: "metric2"
  timestamp: 1726590741666
  datatype: 12
  string_value: "value2"
}
seq: 0
uuid: "DeviceTM_Pending_Policies"
body: "{\n    \"divisionId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2cc\",\n    \"accountId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2cd\",\n    \"deviceId\": \"843fc46c-a77a-4fff-81a7-b4a4f5ccc2ce\",\n    \"status\": \"OK\",\n    \"createdOn\": \"2012-04-23T18:25:43.000Z\",\n    \"updatedOn\": \"2012-04-23T18:25:43.000Z\",\n    \"pendingPolicies\": [\n        {\n            \"deviceGroupId\": \"128975\",\n            \"policyType\": \"CERTIFICATE\",\n            \"policyId\": \"294820113\",\n            \"priority\": 0\n        }\n    ]\n}\n"
*/
unsigned char pending_policies_with_metrics_pb[] = {
  0x08, 0xa1, 0xd9, 0xcf, 0x86, 0xa0, 0x32, 0x12, 0x1a, 0x0a, 0x07, 0x6d,
  0x65, 0x74, 0x72, 0x69, 0x63, 0x31, 0x18, 0xa2, 0xd9, 0xcf, 0x86, 0xa0,
  0x32, 0x20, 0x0c, 0x7a, 0x06, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x12,
  0x1a, 0x0a, 0x07, 0x6d, 0x65, 0x74, 0x72, 0x69, 0x63, 0x32, 0x18, 0xa2,
  0xd9, 0xcf, 0x86, 0xa0, 0x32, 0x20, 0x0c, 0x7a, 0x06, 0x76, 0x61, 0x6c,
  0x75, 0x65, 0x32, 0x18, 0x00, 0x22, 0x19, 0x44, 0x65, 0x76, 0x69, 0x63,
  0x65, 0x54, 0x4d, 0x5f, 0x50, 0x65, 0x6e, 0x64, 0x69, 0x6e, 0x67, 0x5f,
  0x50, 0x6f, 0x6c, 0x69, 0x63, 0x69, 0x65, 0x73, 0x2a, 0xdf, 0x03, 0x7b,
  0x0a, 0x20, 0x20, 0x20, 0x20, 0x22, 0x64, 0x69, 0x76, 0x69, 0x73, 0x69,
  0x6f, 0x6e, 0x49, 0x64, 0x22, 0x3a, 0x20, 0x22, 0x38, 0x34, 0x33, 0x66,
  0x63, 0x34, 0x36, 0x63, 0x2d, 0x61, 0x37, 0x37, 0x61, 0x2d, 0x34, 0x66,
  0x66, 0x66, 0x2d, 0x38, 0x31, 0x61, 0x37, 0x2d, 0x62, 0x34, 0x61, 0x34,
  0x66, 0x35, 0x63, 0x63, 0x63, 0x32, 0x63, 0x63, 0x22, 0x2c, 0x0a, 0x20,
  0x20, 0x20, 0x20, 0x22, 0x61, 0x63, 0x63, 0x6f, 0x75, 0x6e, 0x74, 0x49,
  0x64, 0x22, 0x3a, 0x20, 0x22, 0x38, 0x34, 0x33, 0x66, 0x63, 0x34, 0x36,
  0x63, 0x2d, 0x61, 0x37, 0x37, 0x61, 0x2d, 0x34, 0x66, 0x66, 0x66, 0x2d,
  0x38, 0x31, 0x61, 0x37, 0x2d, 0x62, 0x34, 0x61, 0x34, 0x66, 0x35, 0x63,
  0x63, 0x63, 0x32, 0x63, 0x64, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20,
  0x22, 0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x49, 0x64, 0x22, 0x3a, 0x20,
  0x22, 0x38, 0x34, 0x33, 0x66, 0x63, 0x34, 0x36, 0x63, 0x2d, 0x61, 0x37,
  0x37, 0x61, 0x2d, 0x34, 0x66, 0x66, 0x66, 0x2d, 0x38, 0x31, 0x61, 0x37,
  0x2d, 0x62, 0x34, 0x61, 0x34, 0x66, 0x35, 0x63, 0x63, 0x63, 0x32, 0x63,
  0x65, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x22, 0x73, 0x74, 0x61,
  0x74, 0x75, 0x73, 0x22, 0x3a, 0x20, 0x22, 0x4f, 0x4b, 0x22, 0x2c, 0x0a,
  0x20, 0x20, 0x20, 0x20, 0x22, 0x63, 0x72, 0x65, 0x61, 0x74, 0x65, 0x64,
  0x4f, 0x6e, 0x22, 0x3a, 0x20, 0x22, 0x32, 0x30, 0x31, 0x32, 0x2d, 0x30,
  0x34, 0x2d, 0x32, 0x33, 0x54, 0x31, 0x38, 0x3a, 0x32, 0x35, 0x3a, 0x34,
  0x33, 0x2e, 0x30, 0x30, 0x30, 0x5a, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20,
  0x20, 0x22, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65, 0x64, 0x4f, 0x6e, 0x22,
  0x3a, 0x20, 0x22, 0x32, 0x30, 0x31, 0x32, 0x2d, 0x30, 0x34, 0x2d, 0x32,
  0x33, 0x54, 0x31, 0x38, 0x3a, 0x32, 0x35, 0x3a, 0x34, 0x33, 0x2e, 0x30,
  0x30, 0x30, 0x5a, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x22, 0x70,
  0x65, 0x6e, 0x64, 0x69, 0x6e, 0x67, 0x50, 0x6f, 0x6c, 0x69, 0x63, 0x69,
  0x65, 0x73, 0x22, 0x3a, 0x20, 0x5b, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x7b, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x64, 0x65, 0x76, 0x69, 0x63, 0x65,
  0x47, 0x72, 0x6f, 0x75, 0x70, 0x49, 0x64, 0x22, 0x3a, 0x20, 0x22, 0x31,
  0x32, 0x38, 0x39, 0x37, 0x35, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x70, 0x6f, 0x6c,
  0x69, 0x63, 0x79, 0x54, 0x79, 0x70, 0x65, 0x22, 0x3a, 0x20, 0x22, 0x43,
  0x45, 0x52, 0x54, 0x49, 0x46, 0x49, 0x43, 0x41, 0x54, 0x45, 0x22, 0x2c,
  0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x22, 0x70, 0x6f, 0x6c, 0x69, 0x63, 0x79, 0x49, 0x64, 0x22, 0x3a,
  0x20, 0x22, 0x32, 0x39, 0x34, 0x38, 0x32, 0x30, 0x31, 0x31, 0x33, 0x22,
  0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x22, 0x70, 0x72, 0x69, 0x6f, 0x72, 0x69, 0x74, 0x79, 0x22,
  0x3a, 0x20, 0x30, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x7d, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x5d, 0x0a, 0x7d, 0x0a
};
unsigned int pending_policies_with_metrics_pb_len = 574;

unsigned char pending_policies_no_metrics_pb[] = {
  0x08, 0xb6, 0xa6, 0xdb, 0xbc, 0xa0, 0x32, 0x22, 0x19, 0x44, 0x65, 0x76,
  0x69, 0x63, 0x65, 0x54, 0x4d, 0x5f, 0x50, 0x65, 0x6e, 0x64, 0x69, 0x6e,
  0x67, 0x5f, 0x50, 0x6f, 0x6c, 0x69, 0x63, 0x69, 0x65, 0x73, 0x2a, 0xb5,
  0x03, 0x7b, 0x22, 0x64, 0x69, 0x76, 0x69, 0x73, 0x69, 0x6f, 0x6e, 0x49,
  0x64, 0x22, 0x3a, 0x22, 0x63, 0x37, 0x35, 0x62, 0x36, 0x61, 0x64, 0x34,
  0x2d, 0x62, 0x64, 0x65, 0x65, 0x2d, 0x34, 0x39, 0x66, 0x32, 0x2d, 0x62,
  0x33, 0x32, 0x30, 0x2d, 0x65, 0x35, 0x34, 0x62, 0x64, 0x65, 0x31, 0x64,
  0x64, 0x38, 0x35, 0x38, 0x22, 0x2c, 0x22, 0x61, 0x63, 0x63, 0x6f, 0x75,
  0x6e, 0x74, 0x49, 0x64, 0x22, 0x3a, 0x22, 0x39, 0x39, 0x38, 0x31, 0x35,
  0x30, 0x63, 0x35, 0x2d, 0x32, 0x34, 0x34, 0x33, 0x2d, 0x34, 0x61, 0x62,
  0x66, 0x2d, 0x38, 0x65, 0x64, 0x62, 0x2d, 0x61, 0x37, 0x65, 0x35, 0x30,
  0x35, 0x62, 0x37, 0x62, 0x64, 0x62, 0x64, 0x22, 0x2c, 0x22, 0x64, 0x65,
  0x76, 0x69, 0x63, 0x65, 0x49, 0x64, 0x22, 0x3a, 0x22, 0x66, 0x31, 0x33,
  0x65, 0x38, 0x34, 0x39, 0x64, 0x2d, 0x33, 0x62, 0x63, 0x34, 0x2d, 0x34,
  0x61, 0x64, 0x30, 0x2d, 0x38, 0x64, 0x62, 0x32, 0x2d, 0x34, 0x30, 0x38,
  0x63, 0x39, 0x30, 0x30, 0x61, 0x32, 0x63, 0x38, 0x66, 0x22, 0x2c, 0x22,
  0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x22, 0x3a, 0x22, 0x52, 0x45, 0x47,
  0x49, 0x53, 0x54, 0x45, 0x52, 0x45, 0x44, 0x22, 0x2c, 0x22, 0x63, 0x72,
  0x65, 0x61, 0x74, 0x65, 0x64, 0x4f, 0x6e, 0x22, 0x3a, 0x22, 0x32, 0x30,
  0x32, 0x34, 0x2d, 0x30, 0x39, 0x2d, 0x31, 0x39, 0x54, 0x30, 0x30, 0x3a,
  0x30, 0x30, 0x3a, 0x34, 0x37, 0x5a, 0x22, 0x2c, 0x22, 0x75, 0x70, 0x64,
  0x61, 0x74, 0x65, 0x64, 0x4f, 0x6e, 0x22, 0x3a, 0x22, 0x32, 0x30, 0x32,
  0x34, 0x2d, 0x30, 0x39, 0x2d, 0x31, 0x39, 0x54, 0x30, 0x30, 0x3a, 0x30,
  0x30, 0x3a, 0x34, 0x37, 0x5a, 0x22, 0x2c, 0x22, 0x70, 0x65, 0x6e, 0x64,
  0x69, 0x6e, 0x67, 0x50, 0x6f, 0x6c, 0x69, 0x63, 0x69, 0x65, 0x73, 0x22,
  0x3a, 0x5b, 0x7b, 0x22, 0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x47, 0x72,
  0x6f, 0x75, 0x70, 0x49, 0x64, 0x22, 0x3a, 0x22, 0x31, 0x32, 0x32, 0x38,
  0x61, 0x37, 0x32, 0x66, 0x2d, 0x35, 0x61, 0x66, 0x37, 0x2d, 0x34, 0x66,
  0x33, 0x36, 0x2d, 0x61, 0x64, 0x37, 0x38, 0x2d, 0x31, 0x61, 0x61, 0x61,
  0x31, 0x66, 0x32, 0x32, 0x36, 0x32, 0x30, 0x65, 0x22, 0x2c, 0x22, 0x70,
  0x6f, 0x6c, 0x69, 0x63, 0x79, 0x54, 0x79, 0x70, 0x65, 0x22, 0x3a, 0x22,
  0x43, 0x45, 0x52, 0x54, 0x49, 0x46, 0x49, 0x43, 0x41, 0x54, 0x45, 0x22,
  0x2c, 0x22, 0x70, 0x6f, 0x6c, 0x69, 0x63, 0x79, 0x49, 0x64, 0x22, 0x3a,
  0x22, 0x49, 0x4f, 0x54, 0x5f, 0x64, 0x65, 0x36, 0x39, 0x30, 0x39, 0x61,
  0x39, 0x2d, 0x63, 0x34, 0x36, 0x37, 0x2d, 0x34, 0x62, 0x62, 0x32, 0x2d,
  0x61, 0x62, 0x63, 0x33, 0x2d, 0x36, 0x64, 0x62, 0x36, 0x33, 0x64, 0x64,
  0x30, 0x65, 0x35, 0x34, 0x64, 0x22, 0x2c, 0x22, 0x70, 0x72, 0x69, 0x6f,
  0x72, 0x69, 0x74, 0x79, 0x22, 0x3a, 0x31, 0x2c, 0x22, 0x64, 0x65, 0x70,
  0x6c, 0x6f, 0x79, 0x6d, 0x65, 0x6e, 0x74, 0x49, 0x64, 0x22, 0x3a, 0x6e,
  0x75, 0x6c, 0x6c, 0x7d, 0x5d, 0x7d
};
unsigned int pending_policies_no_metrics_pb_len = 474;

unsigned char trustedge_msg_pb[] = {
  0x08, 0x87, 0x92, 0xac, 0xcd, 0xa0, 0x32, 0x12, 0x1f, 0x0a, 0x0b, 0x6d,
  0x61, 0x63, 0x5f, 0x61, 0x64, 0x64, 0x72, 0x65, 0x73, 0x73, 0x20, 0x0c,
  0x38, 0x01, 0x42, 0x0c, 0x12, 0x0a, 0x61, 0x74, 0x74, 0x72, 0x69, 0x62,
  0x75, 0x74, 0x65, 0x73, 0x22, 0x1e, 0x44, 0x65, 0x76, 0x69, 0x63, 0x65,
  0x54, 0x4d, 0x5f, 0x52, 0x65, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x5f, 0x41,
  0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x5f, 0x4c, 0x69, 0x73, 0x74,
  0x2a, 0x88, 0x05, 0x7b, 0x0a, 0x20, 0x20, 0x22, 0x70, 0x6f, 0x6c, 0x69,
  0x63, 0x79, 0x53, 0x65, 0x72, 0x76, 0x69, 0x63, 0x65, 0x22, 0x20, 0x3a,
  0x20, 0x22, 0x55, 0x70, 0x64, 0x61, 0x74, 0x65, 0x50, 0x6f, 0x6c, 0x69,
  0x63, 0x79, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x22, 0x64, 0x65, 0x76, 0x69,
  0x63, 0x65, 0x49, 0x64, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x33, 0x39, 0x38,
  0x30, 0x61, 0x38, 0x61, 0x66, 0x2d, 0x31, 0x38, 0x30, 0x37, 0x2d, 0x34,
  0x63, 0x61, 0x62, 0x2d, 0x62, 0x39, 0x39, 0x37, 0x2d, 0x39, 0x31, 0x66,
  0x37, 0x37, 0x31, 0x33, 0x33, 0x34, 0x31, 0x31, 0x38, 0x22, 0x2c, 0x0a,
  0x20, 0x20, 0x22, 0x61, 0x63, 0x63, 0x6f, 0x75, 0x6e, 0x74, 0x49, 0x64,
  0x22, 0x20, 0x3a, 0x20, 0x22, 0x39, 0x39, 0x38, 0x31, 0x35, 0x30, 0x63,
  0x35, 0x2d, 0x32, 0x34, 0x34, 0x33, 0x2d, 0x34, 0x61, 0x62, 0x66, 0x2d,
  0x38, 0x65, 0x64, 0x62, 0x2d, 0x61, 0x37, 0x65, 0x35, 0x30, 0x35, 0x62,
  0x37, 0x62, 0x64, 0x62, 0x64, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x22, 0x6d,
  0x6f, 0x64, 0x65, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x72, 0x65, 0x6c, 0x65,
  0x61, 0x73, 0x65, 0x5f, 0x61, 0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74,
  0x5f, 0x6c, 0x69, 0x73, 0x74, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x22, 0x74,
  0x69, 0x6d, 0x65, 0x73, 0x74, 0x61, 0x6d, 0x70, 0x22, 0x20, 0x3a, 0x20,
  0x22, 0x32, 0x30, 0x32, 0x34, 0x2d, 0x30, 0x39, 0x2d, 0x31, 0x39, 0x54,
  0x30, 0x39, 0x3a, 0x34, 0x34, 0x3a, 0x31, 0x36, 0x5a, 0x22, 0x2c, 0x0a,
  0x20, 0x20, 0x22, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65, 0x50, 0x6f, 0x6c,
  0x69, 0x63, 0x79, 0x49, 0x64, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x38, 0x32,
  0x35, 0x66, 0x32, 0x61, 0x30, 0x32, 0x2d, 0x62, 0x38, 0x36, 0x38, 0x2d,
  0x34, 0x64, 0x65, 0x39, 0x2d, 0x38, 0x34, 0x32, 0x61, 0x2d, 0x39, 0x65,
  0x37, 0x37, 0x63, 0x62, 0x66, 0x37, 0x34, 0x38, 0x62, 0x61, 0x22, 0x2c,
  0x0a, 0x20, 0x20, 0x22, 0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x47, 0x72,
  0x6f, 0x75, 0x70, 0x49, 0x64, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x62, 0x30,
  0x66, 0x32, 0x65, 0x34, 0x64, 0x36, 0x2d, 0x62, 0x64, 0x39, 0x64, 0x2d,
  0x34, 0x32, 0x61, 0x61, 0x2d, 0x62, 0x61, 0x34, 0x38, 0x2d, 0x32, 0x36,
  0x39, 0x62, 0x32, 0x63, 0x31, 0x64, 0x37, 0x39, 0x34, 0x36, 0x22, 0x2c,
  0x0a, 0x20, 0x20, 0x22, 0x64, 0x65, 0x70, 0x6c, 0x6f, 0x79, 0x6d, 0x65,
  0x6e, 0x74, 0x49, 0x64, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x36, 0x39, 0x66,
  0x62, 0x36, 0x66, 0x39, 0x64, 0x2d, 0x31, 0x65, 0x35, 0x35, 0x2d, 0x34,
  0x64, 0x61, 0x31, 0x2d, 0x62, 0x62, 0x33, 0x37, 0x2d, 0x34, 0x62, 0x61,
  0x63, 0x36, 0x35, 0x38, 0x64, 0x63, 0x30, 0x32, 0x62, 0x22, 0x2c, 0x0a,
  0x20, 0x20, 0x22, 0x61, 0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x73,
  0x22, 0x20, 0x3a, 0x20, 0x5b, 0x20, 0x7b, 0x0a, 0x20, 0x20, 0x20, 0x20,
  0x22, 0x61, 0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x49, 0x64, 0x22,
  0x20, 0x3a, 0x20, 0x22, 0x66, 0x34, 0x30, 0x64, 0x38, 0x31, 0x39, 0x37,
  0x2d, 0x62, 0x30, 0x37, 0x31, 0x2d, 0x34, 0x65, 0x37, 0x38, 0x2d, 0x39,
  0x31, 0x39, 0x37, 0x2d, 0x33, 0x63, 0x35, 0x36, 0x35, 0x33, 0x38, 0x33,
  0x36, 0x32, 0x63, 0x32, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x22,
  0x61, 0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x4e, 0x61, 0x6d, 0x65,
  0x22, 0x20, 0x3a, 0x20, 0x22, 0x70, 0x6b, 0x2d, 0x70, 0x79, 0x74, 0x68,
  0x6f, 0x6e, 0x2d, 0x64, 0x76, 0x73, 0x6e, 0x31, 0x2d, 0x64, 0x67, 0x31,
  0x2d, 0x61, 0x72, 0x74, 0x66, 0x31, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20,
  0x20, 0x22, 0x61, 0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x56, 0x65,
  0x72, 0x73, 0x69, 0x6f, 0x6e, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x31, 0x2e,
  0x30, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x22, 0x61, 0x72, 0x74,
  0x69, 0x66, 0x61, 0x63, 0x74, 0x54, 0x69, 0x6d, 0x65, 0x73, 0x74, 0x61,
  0x6d, 0x70, 0x22, 0x20, 0x3a, 0x20, 0x22, 0x32, 0x30, 0x32, 0x34, 0x2d,
  0x30, 0x39, 0x2d, 0x31, 0x32, 0x54, 0x31, 0x32, 0x3a, 0x35, 0x33, 0x3a,
  0x34, 0x36, 0x5a, 0x22, 0x2c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x22, 0x61,
  0x72, 0x74, 0x69, 0x66, 0x61, 0x63, 0x74, 0x53, 0x69, 0x7a, 0x65, 0x22,
  0x20, 0x3a, 0x20, 0x31, 0x37, 0x37, 0x34, 0x0a, 0x20, 0x20, 0x7d, 0x20,
  0x5d, 0x0a, 0x7d
};
unsigned int trustedge_msg_pb_len = 723;

ubyte gpMyData[4096] = { 0 };
ubyte4 gMyDataLen = 0;

MSTATUS raw_decoder_cb(
    void *pArg,
    ProtobufRawField *pData,
    byteBoolean finalChunk)
{
    ubyte4 i;
    char *pWireTypeStr = "UNKNOWN";

    DIGI_MEMCPY(gpMyData + gMyDataLen, pData->pBuf, pData->bufLen);
    gMyDataLen += pData->bufLen;

    if (TRUE == finalChunk)
    {
        switch (pData->wireType)
        {
            case PB_VARINT:
                pWireTypeStr = "VARINT";
                break;
            case PB_I64:
                pWireTypeStr = "I64";
                break;
            case PB_LEN:
                pWireTypeStr = "LEN";
                break;
            case PB_I32:
                pWireTypeStr = "I32";
                break;
        }
        printf("FIELD NUMBER (%d) - %s (%d) - LENGTH (%d):", pData->fieldNumber, pWireTypeStr, pData->wireType, pData->totalLen);
        for (i = 0; i < gMyDataLen; i++)
        {
            printf(" %02X", gpMyData[i]);
        }
        printf("\n");

        gMyDataLen = 0;
    }

    return OK;
}

MSTATUS decode_protobuf_raw(ubyte *pMsg, ubyte4 msgLen, ubyte4 chunkSize)
{
    MSTATUS status, fstatus;
    ProtobufContext *pCtx = NULL;
    ubyte4 needToProcess = msgLen;

    status = PROTOBUF_acquireContext(&pCtx);
    if (OK != status)
        goto exit;

    status = PROTOBUF_setRawDecoder(pCtx, raw_decoder_cb, NULL);
    if (OK != status)
        goto exit;

    do
    {
        if (chunkSize > needToProcess)
            chunkSize = needToProcess;

        status = PROTOBUF_rawDecode(pCtx, pMsg, chunkSize);
        if (OK != status)
            goto exit;


        pMsg += chunkSize;
        needToProcess -= chunkSize;

    } while (0 != needToProcess);

exit:

    fstatus = PROTOBUF_releaseContext(&pCtx);
    if (OK == status)
        status = fstatus;

    return status;
}

MSTATUS msg_decoder_cb(
    void *pArg,
    ProtobufMessage *pMsg,
    ubyte4 index,
    ProtobufDecodedField *pField,
    byteBoolean finalChunk)
{
    ubyte4 i;

    switch (pField->fieldType)
    {
        case PB_UINT64:
            printf("FIELD NUMBER (%d) - UINT64: %llu\n", pField->fieldNumber, pField->data.uint64);
            break;

        case PB_STRING:
            printf("FIELD NUMBER (%d) - STRING:", pField->fieldNumber);
            for (i = 0; i < pField->data.bytes.bufLen; i++)
            {
                printf(" %02X", pField->data.bytes.pBuf[i]);;
            }
            printf("\n");
            break;

        case PB_BYTES:
            printf("FIELD NUMBER (%d) - BYTES:", pField->fieldNumber);
            for (i = 0; i < pField->data.bytes.bufLen; i++)
            {
                printf(" %02X", pField->data.bytes.pBuf[i]);;
            }
            printf("\n");
            break;
    }

    return OK;
}

MSTATUS decode_protobuf_msg(ubyte *pMsg, ubyte4 msgLen, ubyte4 chunkSize)
{
    MSTATUS status, fstatus;
    ProtobufContext *pCtx = NULL;
    ProtobufMessage pMetricOneofValue[] = {
        { 15, PB_STRING }
    };
    ProtobufMessage pMetadata[] = {
        { 1, PB_BOOL, PB_OPTIONAL },
        { 2, PB_STRING, PB_OPTIONAL },
        { 3, PB_UINT64, PB_OPTIONAL },
        { 4, PB_UINT64, PB_OPTIONAL },
        { 5, PB_STRING, PB_OPTIONAL },
        { 6, PB_STRING, PB_OPTIONAL },
        { 7, PB_STRING, PB_OPTIONAL },
        { 8, PB_STRING, PB_OPTIONAL }
    };
    ProtobufMessage pMetric[] = {
        { 1, PB_STRING, PB_OPTIONAL },
        { 2, PB_UINT64, PB_OPTIONAL },
        { 3, PB_UINT64, PB_OPTIONAL },
        { 4, PB_UINT32, PB_OPTIONAL },
        { 5, PB_BOOL, PB_OPTIONAL },
        { 6, PB_BOOL, PB_OPTIONAL },
        { 7, PB_BOOL, PB_OPTIONAL },
        { 8, PB_MESSAGE, PB_OPTIONAL, pMetadata, COUNTOF(pMetadata) },
        { 0, PB_ONEOF, 0, pMetricOneofValue, COUNTOF(pMetricOneofValue) }
    };
    ProtobufMessage pPayload[] = {
        { 1, PB_UINT64, PB_OPTIONAL },
        { 2, PB_MESSAGE, PB_REPEATED, pMetric, COUNTOF(pMetric) },
        { 3, PB_UINT64, PB_OPTIONAL },
        { 4, PB_STRING, PB_OPTIONAL },
        { 5, PB_BYTES, PB_OPTIONAL }
    };
    ubyte4 needToProcess = msgLen;

    status = PROTOBUF_acquireContext(&pCtx);
    if (OK != status)
        goto exit;

    status = PROTOBUF_setMessageDecoder(
        pCtx, pPayload, COUNTOF(pPayload), msg_decoder_cb, NULL);
    if (OK != status)
        goto exit;

    do
    {
        if (chunkSize > needToProcess)
            chunkSize = needToProcess;

        status = PROTOBUF_messageDecode(pCtx, pMsg, chunkSize);
        if (OK != status)
            goto exit;


        pMsg += chunkSize;
        needToProcess -= chunkSize;

    } while (0 != needToProcess);

exit:

    fstatus = PROTOBUF_releaseContext(&pCtx);
    if (OK == status)
        status = fstatus;

    return status;
}

int protobuf_test_1()
{
    int retVal = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 3));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 5));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 8));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 13));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 21));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 34));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 55));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 89));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 144));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 233));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 377));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 610));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, 987));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_raw(cert_spec_pb, cert_spec_pb_len, cert_spec_pb_len));

    return retVal;
}


int protobuf_test_2()
{
    int retVal = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 3));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 5));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 8));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 13));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 21));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 34));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 55));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 89));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 144));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 233));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 377));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 610));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, 987));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(cert_spec_pb, cert_spec_pb_len, cert_spec_pb_len));

    return retVal;
}

int protobuf_test_3()
{
    int retVal = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 3));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 5));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 8));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 13));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 21));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 34));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 55));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 89));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 144));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 233));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, 377));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_with_metrics_pb, pending_policies_with_metrics_pb_len, pending_policies_with_metrics_pb_len));

    return retVal;
}

int protobuf_test_4()
{
    int retVal = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 3));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 5));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 8));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 13));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 21));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 34));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 55));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 89));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 144));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 233));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, 377));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(pending_policies_no_metrics_pb, pending_policies_no_metrics_pb_len, pending_policies_no_metrics_pb_len));

    return retVal;
}

int protobuf_test_5()
{
    int retVal = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 3));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 5));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 8));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 13));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 21));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 34));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 55));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 89));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 144));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 233));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 377));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, 610));
    retVal += UNITTEST_STATUS(__MOC_LINE__, decode_protobuf_msg(trustedge_msg_pb, trustedge_msg_pb_len, trustedge_msg_pb_len));

    return retVal;
}

MSTATUS process_protobuf(
    ProtobufMessage *pMsg,
    ubyte4 msgCount,
    ProtobufMessageDecodeCb msgDecodeCb,
    void *pArg,
    ubyte *pBuf,
    ubyte4 bufLen,
    ubyte4 chunkSize)
{
    MSTATUS status, fstatus;
    ProtobufContext *pCtx = NULL;
    ubyte4 needToProcess = bufLen;

    status = PROTOBUF_acquireContext(&pCtx);
    if (OK != status)
        goto exit;

    status = PROTOBUF_setMessageDecoder(pCtx, pMsg, msgCount, msgDecodeCb, pArg);
    if (OK != status)
        goto exit;

    do
    {
        if (chunkSize > needToProcess)
            chunkSize = needToProcess;

        status = PROTOBUF_messageDecode(pCtx, pBuf, chunkSize);
        if (OK != status)
            goto exit;

        pBuf += chunkSize;
        needToProcess -= chunkSize;

    } while (0 != needToProcess);

exit:

    fstatus = PROTOBUF_releaseContext(&pCtx);
    if (OK == status)
        status = fstatus;

    return status;
}

MSTATUS process_protobuf_multi_len(
    ProtobufMessage *pMsg,
    ubyte4 msgCount,
    ProtobufMessageDecodeCb msgDecodeCb,
    void *pArg,
    ubyte *pBuf,
    ubyte4 bufLen)
{
    MSTATUS status = OK;
    ubyte4 i;

    for (i = 1; i <= bufLen; i++)
    {
        status = process_protobuf(pMsg, msgCount, msgDecodeCb, pArg, pBuf, bufLen, i);
        if (OK != status)
            goto exit;
    }

exit:

    return status;
}

MSTATUS validate_field_cb(
    void *pArg,
    ProtobufMessage *pMsg,
    ubyte4 index,
    ProtobufDecodedField *pField,
    byteBoolean finalChunk)
{
    ProtobufDecodedField *pExpected = (ProtobufDecodedField *) pArg;

    if (pField->fieldNumber != pExpected->fieldNumber)
        return ERR_PROTOBUF;

    if (pField->fieldType != pExpected->fieldType)
        return ERR_PROTOBUF;

    switch (pExpected->fieldType)
    {
        case PB_BOOL:
            if (pField->data.boolean != pExpected->data.boolean)
                return ERR_PROTOBUF;
            break;

        case PB_INT32:
            if (pField->data.int32 != pExpected->data.int32)
                return ERR_PROTOBUF;
            break;

        case PB_UINT64:
            if (pField->data.uint64 != pExpected->data.uint64)
                return ERR_PROTOBUF;
            break;

        case PB_UINT32:
            if (pField->data.uint32 != pExpected->data.uint32)
                return ERR_PROTOBUF;
            break;

        default:
            return ERR_PROTOBUF;
    }

    return OK;
}

int protobuf_test_bool()
{
    int retVal = 0;
    ProtobufMessage pBool[] = {
        { 1, PB_BOOL, PB_OPTIONAL }
    };
    /* test boolean true */
    unsigned char boolean_true[] = {
        0x08, 0x01
    };
    ProtobufDecodedField boolean_true_expected = {
        1, PB_BOOL, { .boolean = TRUE }
    };
    /* test boolean false */
    unsigned char boolean_false[] = {
        0x08, 0x00
    };
    ProtobufDecodedField boolean_false_expected = {
        1, PB_BOOL, { .boolean = FALSE }
    };

    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pBool, COUNTOF(pBool), validate_field_cb, &boolean_true_expected, boolean_true, sizeof(boolean_true)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pBool, COUNTOF(pBool), validate_field_cb, &boolean_false_expected, boolean_false, sizeof(boolean_false)));

    return retVal;
}

int protobuf_test_uint64()
{
    int retVal = 0;
    ProtobufMessage pUint64[] = {
        { 1, PB_UINT64, PB_OPTIONAL }
    };
    /* test uint64 0 */
    unsigned char uint64_0[] = {
        0x08, 0x00
    };
    ProtobufDecodedField uint64_0_expected = {
        1, PB_UINT64, { .uint64 = 0 }
    };
    /* test uint64 1 */
    unsigned char uint64_1[] = {
        0x08, 0x01
    };
    ProtobufDecodedField uint64_1_expected = {
        1, PB_UINT64, { .uint64 = 1 }
    };
    /* test uint64 9223372036854775808 */
    unsigned char uint64_9223372036854775808[] = {
        0x08, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01
    };
    ProtobufDecodedField uint64_9223372036854775808_expected = {
        1, PB_UINT64, { .uint64 = 9223372036854775808ULL }
    };
    /* test uint64 18446744073709551614 */
    unsigned char uint64_18446744073709551614[] = {
        0x08, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01
    };
    ProtobufDecodedField uint64_18446744073709551614_expected = {
        1, PB_UINT64, { .uint64 = 18446744073709551614ULL }
    };
    /* test uint64 18446744073709551615 */
    unsigned char uint64_18446744073709551615[] = {
        0x08, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01
    };
    ProtobufDecodedField uint64_18446744073709551615_expected = {
        1, PB_UINT64, { .uint64 = 18446744073709551615ULL }
    };

    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint64, COUNTOF(pUint64), validate_field_cb, &uint64_0_expected, uint64_0, sizeof(uint64_0)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint64, COUNTOF(pUint64), validate_field_cb, &uint64_1_expected, uint64_1, sizeof(uint64_1)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint64, COUNTOF(pUint64), validate_field_cb, &uint64_9223372036854775808_expected, uint64_9223372036854775808, sizeof(uint64_9223372036854775808)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint64, COUNTOF(pUint64), validate_field_cb, &uint64_18446744073709551614_expected, uint64_18446744073709551614, sizeof(uint64_18446744073709551614)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint64, COUNTOF(pUint64), validate_field_cb, &uint64_18446744073709551615_expected, uint64_18446744073709551615, sizeof(uint64_18446744073709551615)));


    return retVal;
}

int protobuf_test_uint32()
{
    int retVal = 0;
    ProtobufMessage pUint32[] = {
        { 1, PB_UINT32, PB_OPTIONAL }
    };
    /* test uint32 0 */
    unsigned char uint32_0[] = {
        0x08, 0x00
    };
    ProtobufDecodedField uint32_0_expected = {
        1, PB_UINT32, { .uint32 = 0 }
    };
    /* test uint32 1 */
    unsigned char uint32_1[] = {
        0x08, 0x01
    };
    ProtobufDecodedField uint32_1_expected = {
        1, PB_UINT32, { .uint32 = 1 }
    };
    /* test uint32 2147483648 */
    unsigned char uint32_2147483648[] = {
        0x08, 0x80, 0x80, 0x80, 0x80, 0x08
    };
    ProtobufDecodedField uint32_2147483648_expected = {
        1, PB_UINT32, { .uint32 = 2147483648 }
    };
    /* test uint32 4294967294 */
    unsigned char uint32_4294967294[] = {
        0x08, 0xfe, 0xff, 0xff, 0xff, 0x0f
    };
    ProtobufDecodedField uint32_4294967294_expected = {
        1, PB_UINT32, { .uint32 = 4294967294 }
    };
    /* test uint32 4294967295 */
    unsigned char uint32_4294967295[] = {
        0x08, 0xff, 0xff, 0xff, 0xff, 0x0f
    };
    ProtobufDecodedField uint32_4294967295_expected = {
        1, PB_UINT32, { .uint32 = 4294967295 }
    };

    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint32, COUNTOF(pUint32), validate_field_cb, &uint32_0_expected, uint32_0, sizeof(uint32_0)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint32, COUNTOF(pUint32), validate_field_cb, &uint32_1_expected, uint32_1, sizeof(uint32_1)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint32, COUNTOF(pUint32), validate_field_cb, &uint32_2147483648_expected, uint32_2147483648, sizeof(uint32_2147483648)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint32, COUNTOF(pUint32), validate_field_cb, &uint32_4294967294_expected, uint32_4294967294, sizeof(uint32_4294967294)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pUint32, COUNTOF(pUint32), validate_field_cb, &uint32_4294967295_expected, uint32_4294967295, sizeof(uint32_4294967295)));

    return retVal;
}

int protobuf_test_int32()
{
    int retVal = 0;
    ProtobufMessage pInt32[] = {
        { 1, PB_INT32, PB_OPTIONAL }
    };
    /* test int32 0 */
    unsigned char int32_0[] = {
        0x08, 0x00
    };
    ProtobufDecodedField int32_0_expected = {
        1, PB_INT32, { .int32 = 0 }
    };
    /* test int32 1 */
    unsigned char int32_1[] = {
        0x08, 0x01
    };
    ProtobufDecodedField int32_1_expected = {
        1, PB_INT32, { .int32 = 1 }
    };
    /* test int32 -1 */
    unsigned char int32_minus_1[] = {
        0x08, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01
    };
    // 7 14 21 28 35
    ProtobufDecodedField int32_minus_1_expected = {
        1, PB_INT32, { .int32 = -1 }
    };
    /* test int32 2147483647 */
    unsigned char int32_2147483647[] = {
        0x08, 0xff, 0xff, 0xff, 0xff, 0x07
    };
    ProtobufDecodedField int32_2147483647_expected = {
        1, PB_INT32, { .int32 = 2147483647 }
    };
    /* test int32 -2147483648 */
    unsigned char int32_minus_2147483648[] = {
        0x08, 0x80, 0x80, 0x80, 0x80, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x01
    };
    ProtobufDecodedField int32_minus_2147483648_expected = {
        1, PB_INT32, { .int32 = -2147483648 }
    };

    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pInt32, COUNTOF(pInt32), validate_field_cb, &int32_0_expected, int32_0, sizeof(int32_0)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pInt32, COUNTOF(pInt32), validate_field_cb, &int32_1_expected, int32_1, sizeof(int32_1)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pInt32, COUNTOF(pInt32), validate_field_cb, &int32_minus_1_expected, int32_minus_1, sizeof(int32_minus_1)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pInt32, COUNTOF(pInt32), validate_field_cb, &int32_2147483647_expected, int32_2147483647, sizeof(int32_2147483647)));
    retVal += UNITTEST_STATUS(__MOC_LINE__, process_protobuf_multi_len(
        pInt32, COUNTOF(pInt32), validate_field_cb, &int32_minus_2147483648_expected, int32_minus_2147483648, sizeof(int32_minus_2147483648)));

    return retVal;
}

int protobuf_test_encode_empty()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}

int protobuf_test_encode_with_uuid()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    payload.pUuid = "some-uuid";

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}

int protobuf_test_encode_with_body()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    payload.pBody = "some-body";
    payload.bodyLen = DIGI_STRLEN("some-body");

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}

int protobuf_test_encode_with_metric()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_addMetricToPayload(&payload, "metric1", "value1", PB_METRIC_DATA_TYPE_STRING, DIGI_STRLEN("value1")));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}

int protobuf_test_encode_with_multiple_metrics()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_addMetricToPayload(&payload, "metric1", "value1", PB_METRIC_DATA_TYPE_STRING, DIGI_STRLEN("value1")));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_addMetricToPayload(&payload, "metric2", "value2", PB_METRIC_DATA_TYPE_STRING, DIGI_STRLEN("value2")));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}

int protobuf_test_encode_with_all_fields()
{
    int retVal = 0;
    ProtobufPayload payload = { 0 };
    ubyte *pOutput = NULL;
    ubyte4 outputLen = 0;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_preparePayload(&payload));
    if (retVal > 0)
        goto exit;

    payload.pUuid = "some-uuid";
    payload.pBody = "some-body";
    payload.bodyLen = DIGI_STRLEN("some-body");

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_addMetricToPayload(&payload, "metric1", "value1", PB_METRIC_DATA_TYPE_STRING, DIGI_STRLEN("value1")));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_addMetricToPayload(&payload, "metric2", "value2", PB_METRIC_DATA_TYPE_STRING, DIGI_STRLEN("value2")));
    if (retVal > 0)
        goto exit;

    retVal += UNITTEST_STATUS(__MOC_LINE__, PROTOBUF_encodePayload(&payload, &pOutput, &outputLen));
    if (retVal > 0)
        goto exit;

exit:

    DIGI_FREE((void **) &pOutput);

    return retVal;
}