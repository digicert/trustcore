/*
 * nist_drbg_hash_unit_test.c
 *
 * unit test for nist_drbg_hash.c
 *
 * Copyright 2025 DigiCert Project Authors. All Rights Reserved.
 * 
 * DigiCert® TrustCore and TrustEdge are licensed under a dual-license model:
 * - **Open Source License**: GNU AGPL v3. See: https://github.com/digicert/trustcore-test/blob/main/LICENSE
 * - **Commercial License**: Available under DigiCert’s Master Services Agreement. See: https://github.com/digicert/trustcore-test/blob/main/LICENSE_COMMERCIAL.txt  
 *   or https://www.digicert.com/master-services-agreement/
 * 
 * *For commercial licensing, contact DigiCert at sales@digicert.com.*
 *
 */

#include "../../common/moptions_custom.h"

#ifdef __ENABLE_DIGICERT_NIST_DRBG_HASH__

#include "../../common/initmocana.h"
#include "../../crypto/nist_drbg_hash.h"
#include "../../crypto/sha1.h"
#include "../../crypto/sha256.h"
#include "../../crypto/sha512.h"

#include "../../../unit_tests/unittest.h"
#include "../../../unit_tests/unittest_utils.h"

/*****************************************************************************/

static int testSha1Simple()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0x13,0x6c,0xf1,0xc1,0x74,0xe5,0xa0,0x9f,0x66,0xb9,0x62,0xd9,0x94,0x39,0x65,0x25};
    ubyte pNonce[8] = {0xff,0xf1,0xc6,0x64,0x5f,0x19,0x23,0x1f};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0x0e,0x28,0x13,0x0f,0xa5,0xca,0x11,0xed,0xd3,0x29,0x3c,0xa2,0x6f,0xdb,0x8a,0xe1,
        0x81,0x06,0x11,0xf7,0x87,0x15,0x08,0x2e,0xd3,0x84,0x1e,0x74,0x86,0xf1,0x66,0x77,
        0xb2,0x8e,0x33,0xff,0xe0,0xb9,0x3d,0x98,0xba,0x57,0xba,0x35,0x8c,0x13,0x43,0xab,
        0x2a,0x26,0xb4,0xeb,0x79,0x40,0xf5,0xbc,0x63,0x93,0x84,0x64,0x1e,0xe8,0x0a,0x25,
        0x14,0x03,0x31,0x07,0x62,0x68,0xbd,0x1c,0xe7,0x02,0xad,0x53,0x4d,0xda,0x0e,0xd8
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;

    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha224Simple()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[24] =
    {
        0x39,0xaf,0x3b,0x54,0x38,0xee,0xf3,0x24,0x20,0x73,0xaa,0x3a,
        0xa7,0xa3,0xcf,0x1b,0x71,0x3c,0xd3,0x8e,0x23,0x0f,0xc7,0x82
    };

    ubyte pNonce[12] = {0x45,0xfa,0xda,0xb7,0xfd,0x23,0x9d,0xf2,0xb9,0xa4,0x78,0x3f};
    ubyte pOutput[112] = {0};
    
    ubyte pExpectedOutput[112] =
    {
        0xd8,0x67,0x92,0xdc,0xa8,0x0f,0x16,0x71,0x84,0xfa,0xd6,0xeb,0xa1,0x88,0xa0,0x81,
        0x60,0xb1,0x4c,0x32,0x4c,0x5e,0x27,0x9d,0x98,0xe5,0xde,0x10,0x47,0x40,0x2e,0x3d,
        0xe7,0x1f,0xe9,0x2a,0xef,0xdf,0xe5,0xc8,0xae,0xcb,0x41,0x67,0x57,0xa6,0x7d,0xcc,
        0xe3,0xd0,0x52,0x3a,0x50,0xec,0xdc,0x38,0x1a,0x98,0xda,0x93,0xa5,0x11,0xac,0x95,
        0xf4,0xa6,0xb7,0xa9,0xc3,0x19,0x2e,0xbe,0x21,0xbb,0xc2,0x7f,0xe0,0x05,0xbc,0x41,
        0x3c,0x1c,0x10,0xa1,0x99,0x5b,0x24,0x07,0x8d,0xd0,0x57,0x27,0xd5,0x5d,0xa6,0x02,
        0xba,0x93,0xa3,0x92,0x76,0x93,0x49,0x99,0x35,0x52,0xa1,0x57,0xf5,0x69,0x9f,0x16
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA224_completeDigest, SHA224_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;

    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha256Simple()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0xa6,0x5a,0xd0,0xf3,0x45,0xdb,0x4e,0x0e,0xff,0xe8,0x75,0xc3,0xa2,0xe7,0x1f,0x42,
        0xc7,0x12,0x9d,0x62,0x0f,0xf5,0xc1,0x19,0xa9,0xef,0x55,0xf0,0x51,0x85,0xe0,0xfb
    };
    
    ubyte pNonce[16] = {0x85,0x81,0xf9,0x31,0x75,0x17,0x27,0x6e,0x06,0xe9,0x60,0x7d,0xdb,0xcb,0xcc,0x2e};
    ubyte pOutput[128] = {0};
    
    ubyte pExpectedOutput[128] =
    {
        0xd3,0xe1,0x60,0xc3,0x5b,0x99,0xf3,0x40,0xb2,0x62,0x82,0x64,0xd1,0x75,0x10,0x60,
        0xe0,0x04,0x5d,0xa3,0x83,0xff,0x57,0xa5,0x7d,0x73,0xa6,0x73,0xd2,0xb8,0xd8,0x0d,
        0xaa,0xf6,0xa6,0xc3,0x5a,0x91,0xbb,0x45,0x79,0xd7,0x3f,0xd0,0xc8,0xfe,0xd1,0x11,
        0xb0,0x39,0x13,0x06,0x82,0x8a,0xdf,0xed,0x52,0x8f,0x01,0x81,0x21,0xb3,0xfe,0xbd,
        0xc3,0x43,0xe7,0x97,0xb8,0x7d,0xbb,0x63,0xdb,0x13,0x33,0xde,0xd9,0xd1,0xec,0xe1,
        0x77,0xcf,0xa6,0xb7,0x1f,0xe8,0xab,0x1d,0xa4,0x66,0x24,0xed,0x64,0x15,0xe5,0x1c,
        0xcd,0xe2,0xc7,0xca,0x86,0xe2,0x83,0x99,0x0e,0xea,0xeb,0x91,0x12,0x04,0x15,0x52,
        0x8b,0x22,0x95,0x91,0x02,0x81,0xb0,0x2d,0xd4,0x31,0xf4,0xc9,0xf7,0x04,0x27,0xdf
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;

    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha384Simple()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x9e,0xf0,0xb0,0x03,0x81,0xd6,0xc8,0xc5,0x4d,0x08,0xfc,0xad,0xc6,0xf5,0xef,0x33,
        0x11,0x34,0xbb,0x98,0x63,0x73,0xf6,0x5c,0x6a,0x14,0xf5,0x53,0xbc,0xb6,0xc5,0x5d
    };
    
    ubyte pNonce[16] = {0x9f,0xce,0x26,0xad,0xa7,0xb1,0xde,0x39,0x59,0x03,0x12,0xbd,0x9d,0x81,0xc4,0xf5};
    ubyte pOutput[192] = {0};
    
    ubyte pExpectedOutput[192] =
    {
        0x66,0x3f,0xfb,0x62,0x5e,0x62,0xc4,0xeb,0x67,0xd7,0x17,0x7a,0x6a,0xbb,0x80,0x8a,
        0x9f,0x68,0xc2,0xd5,0x84,0x0f,0x19,0x99,0x2c,0x11,0xea,0x3a,0x63,0x5d,0x05,0xb5,
        0x37,0xfa,0xe1,0xf1,0x74,0x6c,0x13,0x14,0xe1,0xa7,0x5e,0x14,0x1c,0x2e,0x09,0x41,
        0x87,0xd1,0x7b,0x9d,0xaa,0xe1,0x44,0x2e,0x41,0xd3,0xa0,0xd1,0xfe,0xa9,0x4d,0x8e,
        0xf9,0xd8,0x40,0x11,0x13,0x79,0xa5,0x2e,0x6c,0x7f,0xfa,0xfa,0x7e,0xe8,0x3b,0x24,
        0x4c,0xed,0x12,0x96,0x13,0xd5,0xb8,0xbb,0x08,0x9e,0x7e,0xa2,0x5d,0xe1,0xc2,0x98,
        0x97,0x73,0x5c,0xf9,0x56,0x95,0x04,0x3a,0x64,0x8a,0x2e,0xf6,0xfd,0x4a,0xa7,0x4c,
        0xe8,0x32,0x8a,0x55,0x50,0xda,0x8d,0xdb,0x51,0xf9,0x8a,0xdc,0xdc,0x10,0x8e,0x45,
        0x56,0x03,0xf6,0xf1,0x8f,0x5a,0x50,0x01,0x6f,0x3e,0x8e,0xbc,0xb2,0x44,0xa1,0x6b,
        0xc6,0xb6,0xe5,0x54,0xa7,0x54,0x61,0x53,0xc1,0x2f,0x52,0x2c,0x75,0xca,0x5f,0x10,
        0x17,0xe0,0x1d,0xa3,0x66,0x50,0xe6,0x20,0x3f,0x30,0xed,0x5c,0x3d,0xa3,0xb6,0x07,
        0x87,0x36,0x46,0x5e,0xec,0xb4,0x00,0xee,0xaa,0xa2,0xc8,0x76,0xe3,0x75,0x64,0xd8
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA384_completeDigest, SHA384_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha512Simple()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x6b,0x50,0xa7,0xd8,0xf8,0xa5,0x5d,0x7a,0x3d,0xf8,0xbb,0x40,0xbc,0xc3,0xb7,0x22,
        0xd8,0x70,0x8d,0xe6,0x7f,0xda,0x01,0x0b,0x03,0xc4,0xc8,0x4d,0x72,0x09,0x6f,0x8c,
    };
    
    ubyte pNonce[16] = {0x3e,0xc6,0x49,0xcc,0x62,0x56,0xd9,0xfa,0x31,0xdb,0x7a,0x29,0x04,0xaa,0xf0,0x25};
    ubyte pOutput[256] = {0};
    
    ubyte pExpectedOutput[256] =
    {
        0x95,0xb7,0xf1,0x7e,0x98,0x02,0xd3,0x57,0x73,0x92,0xc6,0xa9,0xc0,0x80,0x83,0xb6,
        0x7d,0xd1,0x29,0x22,0x65,0xb5,0xf4,0x2d,0x23,0x7f,0x1c,0x55,0xbb,0x9b,0x10,0xbf,
        0xcf,0xd8,0x2c,0x77,0xa3,0x78,0xb8,0x26,0x6a,0x00,0x99,0x14,0x3b,0x3c,0x2d,0x64,
        0x61,0x1e,0xee,0xb6,0x9a,0xcd,0xc0,0x55,0x95,0x7c,0x13,0x9e,0x8b,0x19,0x0c,0x7a,
        0x06,0x95,0x5f,0x2c,0x79,0x7c,0x27,0x78,0xde,0x94,0x03,0x96,0xa5,0x01,0xf4,0x0e,
        0x91,0x39,0x6a,0xcf,0x8d,0x7e,0x45,0xeb,0xdb,0xb5,0x3b,0xbf,0x8c,0x97,0x52,0x30,
        0xd2,0xf0,0xff,0x91,0x06,0xc7,0x61,0x19,0xae,0x49,0x8e,0x7f,0xbc,0x03,0xd9,0x0f,
        0x8e,0x4c,0x51,0x62,0x7a,0xed,0x5c,0x8d,0x42,0x63,0xd5,0xd2,0xb9,0x78,0x87,0x3a,
        0x0d,0xe5,0x96,0xee,0x6d,0xc7,0xf7,0xc2,0x9e,0x37,0xee,0xe8,0xb3,0x4c,0x90,0xdd,
        0x1c,0xf6,0xa9,0xdd,0xb2,0x2b,0x4c,0xbd,0x08,0x6b,0x14,0xb3,0x5d,0xe9,0x3d,0xa2,
        0xd5,0xcb,0x18,0x06,0x69,0x8c,0xbd,0x7b,0xbb,0x67,0xbf,0xe3,0xd3,0x1f,0xd2,0xd1,
        0xdb,0xd2,0xa1,0xe0,0x58,0xa3,0xeb,0x99,0xd7,0xe5,0x1f,0x1a,0x93,0x8e,0xed,0x5e,
        0x1c,0x1d,0xe2,0x3a,0x6b,0x43,0x45,0xd3,0x19,0x14,0x09,0xf9,0x2f,0x39,0xb3,0x67,
        0x0d,0x8d,0xbf,0xb6,0x35,0xd8,0xe6,0xa3,0x69,0x32,0xd8,0x10,0x33,0xd1,0x44,0x8d,
        0x63,0xb4,0x03,0xdd,0xf8,0x8e,0x12,0x1b,0x6e,0x81,0x9a,0xc3,0x81,0x22,0x6c,0x13,
        0x21,0xe4,0xb0,0x86,0x44,0xf6,0x72,0x7c,0x36,0x8c,0x5a,0x9f,0x7a,0x4b,0x3e,0xe2,
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA512_completeDigest, SHA512_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha1withPs()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0xf7,0xe3,0x16,0xb1,0x31,0x17,0xdc,0xc1,0x8c,0x44,0x07,0xb6,0xa5,0xcd,0xc5,0xd8};
    ubyte pNonce[8] = {0xb8,0x0d,0xde,0xe7,0x5c,0xf3,0x9a,0x48};
    ubyte pPersonalization[16] = {0x81,0x6c,0xb1,0x37,0xef,0x64,0xf9,0xdf,0x71,0xa3,0xb3,0xa0,0xb3,0xaa,0xf9,0xb1};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0xbe,0x88,0x85,0x85,0xd9,0x5d,0x95,0x26,0x9f,0x00,0x2a,0xbd,0x8b,0x1e,0x33,0xb2,
        0xcb,0x66,0x7a,0x96,0xd3,0xbe,0x6d,0x20,0xd7,0x84,0xb1,0xbb,0xc6,0x63,0x93,0x47,
        0x83,0x7d,0x01,0xd4,0xb9,0x5e,0xed,0x81,0x37,0xcf,0x29,0xfe,0x72,0x4c,0xfe,0xdf,
        0x8b,0x23,0xf9,0x25,0x84,0x80,0xbe,0x35,0x0c,0x34,0x07,0x97,0x3c,0x59,0xa9,0xd7,
        0xf3,0xa6,0x58,0x5b,0x3c,0x0e,0x36,0xa3,0x6c,0x62,0x34,0xd6,0x88,0x52,0xac,0xaf
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha1withAddInput()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0xc3,0xef,0x82,0xce,0x24,0x1f,0x02,0xe4,0x29,0x8b,0x11,0x8c,0xa4,0xf1,0x62,0x25};
    ubyte pNonce[8] = {0x15,0xe3,0x2a,0xbb,0xae,0x6b,0x74,0x33};
    ubyte pAdditionalInput1[16] = {0x2b,0x79,0x00,0x52,0xf0,0x9b,0x36,0x4d,0x4a,0x82,0x67,0xa0,0xa7,0xde,0x63,0xb8};
    ubyte pAdditionalInput2[16] = {0x2e,0xe0,0x81,0x9a,0x67,0x1d,0x07,0xb5,0x08,0x5c,0xc4,0x6a,0xa0,0xe6,0x1b,0x56};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0x58,0x25,0xfa,0x1d,0x1d,0xc3,0x3c,0x64,0xcd,0xc8,0x69,0x06,0x82,0xef,0xf0,0x60,
        0x39,0xe7,0x95,0x08,0xc3,0xaf,0x48,0xe8,0x80,0xf8,0x22,0x7d,0x5f,0x9a,0xaa,0x14,
        0xb3,0xbc,0x76,0xba,0xee,0x47,0x7e,0xbb,0xb5,0xc4,0x55,0x47,0x13,0x41,0x79,0x22,
        0x32,0x57,0x52,0x5e,0x8f,0x3a,0xfe,0xfb,0x78,0xb5,0x9d,0xa0,0x32,0xf1,0x00,0x6d,
        0x74,0xc9,0x83,0x13,0x75,0xa6,0x77,0xea,0xb3,0x23,0x9c,0x94,0xeb,0xe3,0xf7,0xfa
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, pAdditionalInput1, sizeof(pAdditionalInput1), pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, pAdditionalInput2, sizeof(pAdditionalInput2), pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom){
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha1withPSandAddInput()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0x64,0x66,0xe1,0x79,0x9a,0x68,0x01,0x23,0x79,0x63,0x1b,0x3a,0xae,0x41,0xf5,0x9b};
    ubyte pNonce[8] = {0x6b,0x0c,0x61,0x26,0x9f,0x67,0xc5,0x76};
    ubyte pPersonalization[16] = {0xcc,0x93,0x6b,0x87,0xc8,0xc8,0xc1,0xab,0x85,0xdd,0xe0,0xad,0x2e,0x92,0x42,0xb4};
    ubyte pAdditionalInput1[16] = {0xd1,0x03,0x3a,0xc5,0x53,0xef,0x08,0xf2,0x2f,0xd3,0x8f,0x12,0xb4,0x9b,0x45,0xbc};
    ubyte pAdditionalInput2[16] = {0xf0,0x04,0xba,0x01,0xf5,0x14,0x55,0x43,0x0d,0x84,0x36,0x2e,0x37,0x6e,0xb7,0x75};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0x5d,0x67,0x5d,0x1e,0x92,0x49,0x09,0x52,0x70,0x3c,0x19,0x41,0x94,0xe1,0xb0,0x61,
        0xb6,0xec,0x4e,0x21,0x9d,0xc2,0xe1,0xed,0xaa,0x89,0x1e,0xf2,0xd1,0xb7,0xed,0x05,
        0x0a,0x06,0x34,0x2d,0x3c,0x09,0x50,0x11,0xeb,0x33,0x9f,0x19,0x85,0x19,0x77,0x9b,
        0x01,0xab,0x1a,0x58,0x0b,0xd2,0xe3,0x4d,0x6c,0xf4,0xe4,0x7c,0x1b,0xef,0xe0,0xc7,
        0xdc,0x37,0xb4,0xaa,0xfb,0x31,0x12,0x8f,0xa3,0x96,0x26,0x7f,0x37,0x32,0x09,0x5a
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /* as per test specs, call generate twice */
    status = NIST_HASHDRBG_generate(pRandom, pAdditionalInput1, sizeof(pAdditionalInput1), pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, pAdditionalInput2, sizeof(pAdditionalInput2), pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha1AddEntropy()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0x21,0x29,0x56,0x39,0x07,0x83,0x38,0x1d,0xbf,0xc6,0x36,0x2d,0xd0,0xda,0x9a,0x09};
    ubyte pNonce[8] = {0x52,0x80,0x98,0x7f,0xc5,0xe2,0x7a,0x49};
    ubyte pEntropyPR1[16] = {0x2e,0xdb,0x39,0x6e,0xeb,0x89,0x60,0xf7,0x79,0x43,0xc2,0xa5,0x90,0x75,0xa7,0x86};
    ubyte pEntropyPR2[16] = {0x30,0xb5,0x65,0xb6,0x3a,0x50,0x12,0x67,0x69,0x40,0xd3,0xef,0x17,0xd9,0xe9,0x96};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0xca,0x50,0xec,0x95,0xc7,0xc3,0x8a,0x58,0x12,0x9f,0xd3,0x75,0x23,0xd1,0xf2,0x59,
        0x8c,0xe6,0xde,0x98,0xa6,0xf1,0x07,0x72,0x4c,0x55,0x46,0xbe,0xad,0xaa,0x5b,0xaf,
        0xbf,0x1e,0x62,0xd2,0x74,0x84,0x3f,0x11,0x07,0xc3,0x45,0xb1,0x28,0x81,0x63,0xf1,
        0xdd,0x24,0xaf,0xb2,0x7a,0x63,0xd3,0x9e,0xe2,0xaa,0x77,0x0d,0xfc,0xa6,0x68,0xeb,
        0x13,0x4a,0xbe,0x08,0x05,0x78,0xb2,0xf8,0xd1,0xa3,0xa8,0x99,0xf5,0xa0,0x0a,0xf7
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha224AddEntropy()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[24] =
    {
        0x5c,0x15,0x93,0x1a,0x3b,0x7e,0xbf,0x15,0xa9,0x1c,0x57,0x40,
        0x0e,0xf1,0x7a,0x1f,0xb4,0x90,0x8b,0xe2,0xdd,0x4e,0xac,0xf8
    };

    ubyte pNonce[12] = {0xf7,0x50,0x99,0x49,0xb4,0x18,0x90,0x7f,0xbf,0x32,0x34,0x36};

    ubyte pEntropyPR1[24] =
    {
        0x89,0xe5,0x4e,0x74,0x87,0x21,0xb0,0x05,0x2f,0x0a,0x63,0x31,
        0xaf,0xce,0x09,0x62,0x8b,0x82,0xc3,0xe0,0x14,0xcb,0xaf,0x0e
    };
    
    ubyte pEntropyPR2[24] =
    {
        0xc5,0x19,0x81,0x2b,0x53,0xcb,0xea,0x72,0x90,0x03,0x06,0xa2,
        0x4b,0x59,0xa0,0x6e,0x57,0x3d,0xe6,0x30,0x71,0xd4,0x27,0xb0
    };
    
    ubyte pOutput[112] = {0};
    
    ubyte pExpectedOutput[112] =
    {
        0x4b,0x43,0xa1,0x4b,0x3b,0x7d,0x07,0x6f,0x46,0x3e,0x66,0xdf,0x26,0x26,0x95,0x96,
        0xe3,0x4d,0x8b,0xcc,0x7a,0x68,0x3d,0x63,0xba,0xf0,0xb2,0xbe,0x97,0xae,0x3d,0x97,
        0x64,0xb6,0xf9,0x13,0x49,0x18,0x4a,0x9e,0xaf,0xda,0x88,0x59,0xd3,0x3c,0x63,0x2d,
        0xb2,0x25,0x0b,0xff,0x95,0x49,0x7a,0xdc,0x82,0x50,0xd6,0xef,0x7d,0x70,0xb9,0x19,
        0xfd,0x65,0x91,0xbd,0xa1,0xb7,0x31,0x1b,0xde,0x79,0x69,0x66,0x5f,0x3b,0x9d,0x9f,
        0xcb,0xb0,0x23,0xdb,0x75,0xd5,0x5a,0xd1,0x77,0xc7,0x99,0x79,0xa1,0x5d,0xd2,0x05,
        0x6f,0x22,0x65,0x83,0x91,0x92,0xab,0x30,0x09,0x21,0xe3,0xbb,0x53,0x07,0x68,0x95
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA224_completeDigest, SHA224_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;

    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}
/*****************************************************************************/

static int testSha256AddEntropy()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x4a,0x4e,0x74,0x3f,0x87,0x7e,0xa6,0xe9,0x4e,0x54,0x5a,0x56,0xcc,0xb5,0xa1,0xf9,
        0x9e,0xfc,0x7e,0xb1,0xe8,0x19,0x19,0x29,0x15,0x2a,0x56,0xd4,0x1d,0xc9,0x24,0x25
    };
    
    ubyte pNonce[16] = {0x33,0xb7,0xab,0x93,0x56,0xac,0xf7,0xda,0x03,0xd3,0xd6,0x77,0x3b,0x61,0xf8,0xd9};
    
    ubyte pEntropyPR1[32] =
    {
        0x2e,0x14,0x8f,0x92,0x69,0xd0,0x0a,0x16,0x2e,0x89,0x7a,0x91,0xf3,0xac,0xa4,0x6f,
        0xed,0x1e,0x2a,0xdb,0xab,0x4f,0x84,0x82,0x18,0xf2,0x88,0x65,0x0d,0xab,0x8b,0x1e
    };
    
    ubyte pEntropyPR2[32] =
    {
        0x25,0x66,0x47,0x53,0x53,0xec,0x8c,0xed,0x47,0xd0,0x3b,0x76,0xfc,0xa7,0x79,0xd0,
        0x66,0x8c,0x95,0x13,0x6c,0xf7,0x86,0x62,0x59,0xd9,0xe3,0xb7,0xe0,0xd1,0xf7,0x4f
    };
    
    ubyte pOutput[128] = {0};
    
    ubyte pExpectedOutput[128] =
    {
        0x92,0x4b,0x74,0xd6,0xba,0x3d,0x56,0xdf,0xfc,0x0d,0xe0,0x07,0x11,0xe3,0x01,0x0c,
        0xcb,0xdb,0x73,0x07,0x18,0x74,0x3f,0x0c,0xc0,0x63,0x19,0x31,0x43,0x4b,0x0f,0xfc,
        0x4a,0xd6,0xd5,0xef,0x96,0xfd,0x81,0xf1,0x6e,0x51,0xa1,0x02,0x06,0xf6,0x74,0x98,
        0x7d,0x1b,0x52,0xf0,0xcf,0x15,0xd2,0x94,0xc9,0x8b,0xc4,0xa8,0x77,0xf4,0x71,0x6c,
        0x0f,0xf2,0xc2,0x48,0x4d,0x3f,0x05,0x7e,0xaf,0xd0,0x91,0x54,0x87,0x4a,0xa2,0xa2,
        0x13,0xa2,0x64,0x1d,0xa1,0xa3,0xd7,0xbe,0x69,0x88,0x61,0x6b,0x6b,0xb4,0x83,0xcd,
        0x92,0x13,0xed,0x75,0x08,0x58,0xce,0x85,0x81,0x1b,0x8f,0x70,0x8d,0xcf,0xd6,0x07,
        0xb3,0x83,0xed,0xa8,0x45,0xc8,0x7f,0x60,0x08,0x4d,0xb7,0xa0,0x50,0x06,0x43,0xb1
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha1WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[16] = {0x8b,0x76,0x99,0x15,0x91,0x7b,0xbf,0x4e,0x4b,0x48,0xf2,0x66,0x39,0x30,0x61,0x52};
    ubyte pNonce[8] = {0x17,0xea,0x14,0xe8,0xad,0x54,0x46,0xaa};
    ubyte pPersonalization[16] = {0x99,0x94,0xed,0x56,0xb1,0x35,0x5a,0x6d,0x60,0x3e,0x36,0x6a,0x8f,0x9c,0x04,0xa9};
    ubyte pEntropyPR1[16] = {0x36,0x39,0x1d,0x0d,0x89,0x75,0x10,0xaa,0x84,0x4c,0x99,0x20,0x48,0x8d,0x49,0xf2};
    ubyte pAdditionalInput1[16] = {0x1b,0x8c,0x8b,0x88,0xd7,0xce,0x96,0xeb,0x7a,0xbd,0x03,0xb5,0x55,0x1c,0xe9,0x9d};
    ubyte pEntropyPR2[16] = {0x74,0xc7,0xb5,0x4e,0x9f,0xdc,0x82,0x4f,0xc8,0xe0,0x46,0x36,0x73,0xef,0x92,0xbc};
    ubyte pAdditionalInput2[16] = {0xfa,0xb6,0xfc,0x0a,0xcb,0x22,0x98,0x38,0x65,0xc3,0x83,0x62,0x53,0x71,0x8f,0x31};
    ubyte pOutput[80] = {0};
    
    ubyte pExpectedOutput[80] =
    {
        0x1f,0x07,0x77,0x2a,0x46,0x66,0x2b,0x37,0x50,0xe3,0x9b,0x31,0x91,0xfa,0x74,0xc8,
        0x35,0x4f,0x9d,0x7e,0xae,0xa5,0x6b,0xa0,0xd2,0x92,0x72,0xd0,0x71,0xef,0x6d,0xa2,
        0x41,0x1c,0xd0,0x5b,0x64,0x76,0x2e,0x27,0xa7,0x36,0xb0,0x88,0xd9,0x2d,0xad,0x4f,
        0x22,0x2e,0xfa,0x3e,0x3c,0xa2,0xbe,0xe0,0xd5,0xf1,0x40,0x1d,0x7e,0xf5,0x3e,0x38,
        0x42,0x13,0x21,0x81,0x51,0x1a,0x51,0x59,0xbc,0x8e,0xa3,0xa6,0xdb,0x12,0x15,0xab
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA1_completeDigest, SHA1_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha224WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[24] =
    {
        0x34,0xfa,0xb2,0x31,0x25,0x15,0xc9,0x5c,0x5f,0xe8,0xe0,0x3a,
        0xf8,0x50,0xde,0x18,0xbc,0x44,0xa0,0x00,0xe7,0xd5,0x94,0xfb
    };
    
    ubyte pNonce[12] = {0xdc,0x51,0xcd,0x1a,0xd1,0x33,0xdf,0xde,0x1b,0xf3,0xf9,0x5f};
    
    ubyte pPersonalization[24] =
    {
        0x6e,0x16,0x5a,0x35,0x3b,0xc7,0x4f,0x06,0x35,0x6f,0x45,0x02,
        0x9d,0xca,0x47,0xdb,0x81,0x86,0x74,0x5a,0x9f,0x90,0xa7,0x58
    };
    
    ubyte pEntropyPR1[24] =
    {
        0x13,0xe8,0x56,0xa7,0x0d,0x3e,0x56,0x6d,0x00,0x20,0xce,0x13,
        0x9a,0x0c,0x17,0x93,0x12,0x12,0xe9,0x24,0x1d,0x7b,0xda,0xbc
    };
    
    ubyte pAdditionalInput1[24] =
    {
        0x97,0x40,0xb1,0x68,0x06,0xf3,0xc2,0x67,0xbc,0xeb,0x69,0x3a,
        0x4e,0xf5,0xc5,0xb4,0x46,0xd9,0x51,0x8a,0x2e,0x8a,0x78,0x38
    };
    
    ubyte pEntropyPR2[24] =
    {
        0x44,0x47,0xc4,0xdb,0x8c,0x47,0xbb,0x00,0x28,0xf1,0x88,0xac,
        0xce,0x5e,0x8e,0xce,0x3f,0x33,0xb1,0x66,0xc8,0xeb,0x37,0x3c
    };
    
    ubyte pAdditionalInput2[24] =
    {
        0xfa,0x51,0x6f,0x68,0x9f,0x55,0xd8,0x9e,0x69,0x65,0xd1,0x5c,
        0x83,0x84,0x52,0x0a,0xb2,0x0f,0x02,0x7f,0xf2,0x24,0xfb,0x80
    };
    
    ubyte pOutput[112] = {0};
    
    ubyte pExpectedOutput[112] =
    {
        0x32,0x44,0xb8,0x43,0x16,0xbd,0xff,0x4d,0xff,0x5b,0xec,0xdf,0x72,0x30,0x57,0x67,
        0xa4,0x2d,0x40,0x4d,0x07,0x7b,0xba,0x57,0x8f,0x2c,0xad,0x94,0xb9,0xca,0x9a,0x9e,
        0xfe,0x08,0x5e,0xeb,0xdb,0xe1,0xb7,0x7e,0x2a,0xbb,0xcd,0x18,0xe6,0xc1,0x52,0x97,
        0x9b,0xd6,0x54,0x1a,0x68,0x31,0xb1,0xac,0x1c,0x58,0x54,0x94,0x61,0x95,0x20,0x90,
        0xa8,0xbf,0x91,0x11,0xad,0xaf,0x8b,0x24,0x9e,0x8c,0x58,0x47,0x6c,0x45,0x0c,0x59,
        0x0d,0x95,0xc4,0x5f,0xee,0x2d,0x1d,0x2e,0x58,0x75,0x3a,0x4e,0x91,0x3c,0xc1,0xb9,
        0xbf,0x37,0x41,0x11,0xa3,0xa5,0xfa,0xad,0xcc,0x97,0x5b,0x65,0x63,0x4d,0x4c,0x12
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA224_completeDigest, SHA224_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha256WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x29,0xe1,0xa4,0x27,0x09,0xb7,0xe8,0x4d,0xbe,0x50,0x78,0x8f,0xba,0xd8,0xcb,0x60,
        0x9c,0x12,0x7e,0xec,0x32,0x62,0x63,0x6a,0x51,0x3f,0xd9,0x05,0x9f,0xb8,0xba,0xe4
    };
    
    ubyte pNonce[16] = {0xf3,0xa5,0x21,0xf2,0x8d,0xff,0xbd,0x97,0x57,0x4c,0x40,0x5b,0x69,0xb6,0x36,0xad};
    
    ubyte pPersonalization[32] =
    {
        0xc9,0x9a,0x11,0x47,0xd8,0xdb,0x40,0x1f,0x4f,0xcf,0x76,0x38,0x67,0x29,0x67,0x58,
        0xe2,0x64,0x04,0xa3,0x0a,0x4a,0x9f,0xa4,0x96,0xa7,0x17,0xf2,0x1f,0x5d,0x74,0x9b
    };
    
    ubyte pEntropyPR1[32] =
    {
        0xd5,0x26,0x6c,0x01,0xe1,0x0d,0x72,0xdd,0x7e,0x8a,0x3b,0xf7,0x17,0xcc,0xcb,0x8f,
        0x64,0x3c,0xa2,0x33,0x31,0x4e,0x3e,0x74,0xf1,0x06,0xf4,0x6b,0x09,0x0e,0x5c,0x73
    };
    
    ubyte pAdditionalInput1[32] =
    {
        0x17,0x25,0x4e,0xa3,0x92,0xae,0xad,0x0d,0xc9,0x49,0x92,0xd8,0x67,0x81,0x34,0x97,
        0xd3,0xfd,0x6d,0xc7,0x66,0x96,0x67,0x15,0x0a,0xfe,0x6c,0x28,0xa2,0xb8,0x99,0x46
    };
    
    ubyte pEntropyPR2[32] =
    {
        0xc7,0xe5,0xf0,0x3d,0x26,0xbd,0xf9,0x55,0x33,0x38,0xe6,0x4b,0xa6,0x4c,0xe5,0xb5,
        0x75,0x1b,0x04,0xf9,0xc6,0x99,0x92,0x22,0x14,0x95,0xf2,0x22,0x7b,0x97,0x99,0xd0
    };
    
    ubyte pAdditionalInput2[32] =
    {
        0x15,0x7d,0xde,0x59,0xce,0xb2,0xc6,0x62,0xc8,0x66,0x5f,0xbe,0x62,0x3e,0xc7,0x58,
        0x73,0xfd,0x0c,0x5c,0xcc,0xe7,0x9a,0x9f,0x5b,0x70,0x98,0xec,0x8e,0xd7,0x7b,0x67
    };
    
    ubyte pOutput[128] = {0};
    
    ubyte pExpectedOutput[128] =
    {
        0xe3,0x04,0xde,0x9f,0xfd,0x88,0x5c,0xf9,0x17,0xea,0xd7,0x8f,0x05,0x93,0x9b,0x8c,
        0xf5,0x47,0x09,0xfc,0x2d,0x0c,0x79,0x9a,0x98,0xb5,0x43,0x48,0x63,0x37,0x20,0x44,
        0x77,0xb1,0x06,0x0b,0xce,0xae,0x2a,0x22,0xf7,0xff,0x42,0xb6,0xcb,0x4b,0x4b,0xc0,
        0x61,0x0a,0xe2,0xb6,0x75,0x58,0xa7,0xc5,0x4b,0x65,0xe4,0x5b,0xb9,0xf1,0xa8,0x69,
        0x81,0xb7,0x47,0x05,0xb4,0x8c,0xdb,0xf7,0xd8,0xde,0xcf,0x87,0x86,0x82,0x67,0xbd,
        0x94,0x8e,0x93,0x94,0xaa,0x43,0x57,0xf8,0xdb,0xbf,0x30,0x61,0x2a,0x0e,0xb5,0xb1,
        0x31,0x88,0x4c,0x22,0x0e,0x44,0x2d,0x36,0x77,0x8e,0x8d,0x74,0x09,0x1d,0x8a,0x27,
        0xc0,0x70,0xfe,0x69,0x04,0x69,0xe0,0x7f,0x3a,0xab,0xee,0xf7,0xc6,0x29,0xbf,0xab
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha512_224WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[24] =
    {
        0x3a,0x99,0x8d,0x04,0x65,0xee,0x93,0xc0,0xac,0x28,0x2e,0x46,0xa4,0xa4,0xc1,0x95,
        0x56,0xac,0x31,0x2f,0x1c,0xb8,0xa2,0x11,
    };
    
    ubyte pNonce[12] = {0x43,0x8d,0x18,0x9a,0x78,0xd5,0xe2,0xaf,0xff,0x33,0xac,0x68,};
    
    ubyte pPersonalization[24] =
    {
        0xe9,0x1a,0xae,0x96,0x72,0xfa,0x87,0x86,
        0x25,0x28,0xfe,0xf1,0x20,0xb6,0x9b,0x1e,0x1c,0xf6,0xf1,0xee,0xf7,0x5a,0xbe,0x72,

    };
    
    ubyte pEntropyPR1[24] =
    {
        0x1c,0x69,0x56,0x7b,0x69,0x96,0x93,0x55,
        0x04,0xa7,0x36,0xd9,0xd5,0xc2,0x78,0xdd,0x08,0x7b,0xe4,0x70,0xe7,0xbf,0x7f,0x14,
    };
    
    ubyte pAdditionalInput1[24] =
    {
        0xe8,0x25,0xec,0x87,0xc6,0x94,0x48,0x5e,0x64,0xb2,0x72,0x8c,0xbc,0xb6,0x4a,0x0f,
        0x15,0xb6,0xb0,0x65,0x29,0xda,0x3e,0xa0,
    };
    
    ubyte pEntropyPR2[24] =
    {
        0x50,0x95,0x0a,0x65,0x99,0xa3,0x36,0x11,
        0xe0,0x48,0x05,0x4e,0xba,0x63,0x0a,0x55,0x45,0x3a,0x33,0xea,0x9d,0x73,0xf1,0xca,
    };
    
    ubyte pAdditionalInput2[24] =
    {
        0x5c,0x9b,0x5b,0xa1,0x0a,0x0b,0xae,0x85,0x5e,0x4d,0x2d,0x8a,0x1c,0x4d,0xdc,0x11,
        0xca,0xdf,0x1c,0x48,0xe4,0x2b,0x6e,0xcb,
    };
    
    ubyte pOutput[112] = {0};
    
    ubyte pExpectedOutput[112] =
    {
        0x6a,0xa7,0xbe,0x17,0xed,0x06,0x8f,0xd8,0x77,0xb8,0x82,0xb4,0xd7,0x12,0xcc,0x86,
        0x96,0xc4,0xb6,0x40,0x8f,0x59,0xe9,0x4b,0x29,0x28,0x70,0xb9,0x0c,0x6d,0xd5,0x9f,
        0x09,0x98,0x15,0xf7,0x53,0xa1,0x9c,0x45,0xd3,0xe6,0x63,0xc7,0x03,0x32,0x2d,0x38,
        0xa1,0x60,0x75,0x9b,0x23,0xb1,0x3d,0xd0,0x32,0x11,0x27,0x09,0x66,0x0d,0xdc,0xd5,
        0x72,0x7d,0xab,0x39,0xb3,0x7e,0xdc,0x0a,0xe6,0xad,0xa1,0x3b,0x50,0xaf,0x53,0xe7,
        0x59,0xda,0x7e,0xf2,0x47,0xca,0xbe,0xfb,0xe2,0x9d,0x43,0x3b,0x40,0xa8,0x4b,0xe3,
        0x30,0x14,0x23,0xac,0x9f,0xb2,0x7d,0x06,0xd9,0x61,0xfe,0x95,0x8b,0xf7,0xfd,0x73,
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), NULL /* &SHA512_224_completeDigest */, 28);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha512_256WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x60,0xbd,0xd4,0x48,0x5e,0x7e,0xdb,0x63,0x12,0x1b,0x21,0x8f,0x5d,0xf8,0x79,0xa9,
        0xd6,0x4b,0xa2,0x41,0x50,0x71,0x09,0x47,0x73,0x04,0x82,0xac,0x79,0x1d,0x21,0xe3,
    };
    
    ubyte pNonce[16] = {0xbe,0xe0,0x1a,0x4a,0x18,0x91,0x0c,0xb5,0x03,0xdf,0xdc,0x06,0xdd,0x8c,0xe6,0x22};
    
    ubyte pPersonalization[32] =
    {
        0x55,0xa0,0x83,0x57,0xb2,0xaf,0x40,0xc8,0xe1,0xad,0xfe,0x36,0x37,0x53,0x1a,0xc5,
        0x34,0x69,0xa1,0x58,0x89,0x95,0x71,0x62,0x7c,0xf0,0x61,0x20,0x88,0x3f,0xe4,0xb4,
    };
    
    ubyte pEntropyPR1[32] =
    {
        0x2f,0xba,0x07,0x1c,0x41,0x49,0x8b,0xaf,0xd0,0xa0,0xc1,0x88,0xdf,0x30,0x7e,0x47,
        0x42,0x96,0x58,0x9a,0xfc,0xda,0x1b,0xd2,0xe4,0x3a,0xa9,0xcd,0xe2,0x1c,0xe6,0xc4,
    };
    
    ubyte pAdditionalInput1[32] =
    {
        0x91,0x7a,0x6c,0x8f,0x17,0x94,0xff,0x43,0xf9,0x70,0x9f,0xcf,0xfa,0xba,0xf1,0xb9,
        0x10,0x0c,0xf3,0xf6,0x17,0xe9,0x12,0xb1,0xef,0xef,0x13,0x87,0x1f,0x27,0xb2,0xf2,
    };
    
    ubyte pEntropyPR2[32] =
    {
        0xa1,0x31,0x57,0xf1,0xe0,0x00,0x44,0x26,0xd5,0x11,0x7a,0x82,0x12,0x73,0x06,0xd0,
        0xb0,0xce,0x1c,0x33,0xec,0xea,0xff,0xb0,0x39,0xbc,0xac,0x81,0xe3,0x57,0xb2,0xcd,
    };
    
    ubyte pAdditionalInput2[32] =
    {
        0x75,0xa3,0xd5,0x48,0x2c,0x6f,0xaa,0x7b,0xa6,0xf2,0x23,0x79,0x35,0x0e,0x23,0x1e,
        0xb8,0x60,0xb9,0x09,0xdc,0x51,0x85,0x86,0xed,0x96,0xdd,0xe8,0x39,0x5d,0xd0,0x26,
    };
    
    ubyte pOutput[128] = {0};
    
    ubyte pExpectedOutput[128] =
    {
        0xb6,0x46,0x68,0xe9,0x08,0xd6,0x70,0xb3,0x19,0xff,0x7d,0xc3,0xa8,0x20,0x64,0xb8,
        0x86,0x92,0x6c,0x56,0xb3,0x40,0xf3,0x75,0x49,0x1a,0xb8,0xa7,0x85,0x8a,0x3c,0x46,
        0x63,0x91,0x1f,0xbb,0x72,0x42,0x16,0xed,0x05,0xac,0xd8,0xfb,0xe8,0xab,0x51,0x52,
        0x4e,0x75,0x80,0x89,0x0b,0x4b,0xc5,0x6b,0x6e,0x5f,0xc8,0x82,0x74,0x2e,0x4d,0xc7,
        0xea,0x82,0x41,0xab,0xd4,0x5e,0x04,0xcd,0x20,0x34,0x7b,0xe5,0x84,0x9c,0x30,0xd8,
        0x70,0x9f,0x07,0x4e,0x0c,0x5c,0x24,0xf5,0x9b,0x35,0x61,0x22,0xfb,0x4d,0xda,0xe4,
        0x70,0xf5,0x83,0x02,0xd7,0xc9,0x22,0xc6,0x5f,0xa4,0x0e,0x95,0xb2,0x75,0x53,0xe9,
        0xcf,0x4e,0x09,0xf2,0x4b,0x51,0xf5,0x64,0x31,0x34,0xdd,0x5b,0x4d,0xfc,0xea,0xbb,
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), NULL /* &SHA512_256_completeDigest */, 32);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha384WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x9a,0x83,0x58,0xa1,0x7f,0x75,0xe2,0x78,0x4e,0x27,0xd4,0x2c,0x6c,0x59,0x1c,0xaa,
        0xb3,0xc0,0x10,0xc9,0xe7,0x43,0xbc,0x75,0x9f,0xe5,0x5d,0xe4,0xa5,0x84,0xd4,0x23,
    };
    
    ubyte pNonce[16] = {0x65,0x22,0x3e,0x4f,0x3c,0xd2,0x3b,0x59,0xb1,0xed,0x9c,0xb6,0xb5,0x28,0x3a,0x41};
    
    ubyte pPersonalization[32] =
    {
        0x92,0x30,0x7d,0x1c,0xc5,0xf1,0xa3,0xae,0x30,0x8c,0x17,0xdc,0x9d,0x0e,0xd9,0x55,
        0x7e,0x1d,0xee,0x6d,0x55,0xe7,0x70,0xff,0x7e,0x17,0x5c,0x3d,0x15,0x7f,0xc2,0xb5,
    };
    
    ubyte pEntropyPR1[32] =
    {
        0x4d,0x99,0x5c,0x60,0x3e,0x04,0x28,0x04,0x79,0x8a,0x71,0x6b,0xe9,0x6a,0x56,0x41,
        0x63,0x1c,0x39,0x5c,0x17,0x70,0x2a,0xc7,0xc9,0x26,0x68,0xdc,0xc4,0xba,0x0a,0xb9,
    };
    
    ubyte pAdditionalInput1[32] =
    {
        0xd7,0x52,0xa6,0x9a,0xf7,0x02,0xcb,0xa6,0xb3,0x61,0xa7,0xab,0xd5,0xc6,0xd0,0x52,
        0x8c,0x11,0x76,0x9c,0x79,0x57,0x4a,0x1c,0x9e,0xc5,0xa8,0x60,0x15,0x51,0x5f,0x54,
    };
    
    ubyte pEntropyPR2[32] =
    {
        0x7a,0x92,0xd0,0xfa,0x9b,0x3b,0x33,0xce,0x5b,0xe5,0x07,0x71,0x93,0xee,0xce,0x58,
        0xc6,0x33,0x9a,0xec,0x6e,0xe6,0x32,0x9f,0x86,0xf1,0xde,0xdd,0x18,0xa7,0xda,0x29,
    };
    
    ubyte pAdditionalInput2[32] =
    {
        0x94,0xdd,0x63,0xef,0x2e,0xc0,0x18,0x8b,0xd2,0xd0,0x6c,0x64,0xa6,0x00,0xcb,0xe5,
        0x83,0xe8,0x3a,0xd5,0x0d,0xe3,0xee,0x5f,0x95,0x29,0x67,0x4e,0xda,0x6a,0xbc,0xa6,
    };
    
    ubyte pOutput[192] = {0};
    
    ubyte pExpectedOutput[192] =
    {
        0x2b,0x8d,0x13,0x05,0xf3,0xaf,0xd4,0x38,0x78,0x3f,0x07,0x30,0x31,0xfd,0xc3,0x65,
        0xbd,0x83,0xaf,0xed,0x79,0x10,0xc7,0x7b,0xef,0x8e,0x67,0x79,0xe9,0x66,0xaa,0x20,
        0xae,0xc0,0x4f,0x16,0x93,0x76,0x4f,0x20,0x9d,0xff,0xec,0x6c,0xab,0xf8,0xb6,0x61,
        0xf5,0x64,0x07,0x23,0x2d,0x08,0xde,0xcf,0xd2,0xfc,0x99,0x13,0x28,0xec,0x1c,0xd6,
        0xa9,0x55,0x06,0xd1,0xb3,0x33,0xc4,0x3b,0xcd,0x3c,0x11,0x56,0xc2,0xe9,0xe0,0xdc,
        0xaf,0x52,0x69,0xf2,0x27,0x3a,0xc3,0xdd,0x8a,0x89,0xa6,0x33,0x03,0xc8,0xa6,0x3f,
        0x80,0xe0,0x16,0xa5,0x77,0xc0,0x51,0x4f,0xaf,0x0c,0xdf,0xc7,0x7e,0x5d,0xdc,0xbc,
        0xd8,0xcf,0x22,0x8d,0xb2,0xda,0x4e,0x2f,0xf3,0x80,0x4b,0x53,0x0b,0xd2,0xa8,0xd0,
        0xf4,0xce,0x34,0x8b,0x35,0x66,0x18,0xe5,0x1d,0x07,0xf0,0x6c,0x97,0xb9,0xe4,0xaf,
        0xf1,0xad,0x14,0xcc,0xb9,0x05,0xb0,0xc1,0x68,0x28,0x9c,0x28,0x8e,0xdb,0x3f,0x7d,
        0x05,0x6d,0xb0,0xeb,0x8d,0x21,0xc5,0x35,0x28,0x71,0xe3,0x4a,0xee,0x0e,0x26,0x1e,
        0xb7,0x5d,0xb5,0x2c,0x0e,0x0e,0xdd,0x3f,0x9e,0x91,0xcc,0x30,0xd6,0x8f,0x9a,0x49,
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA384_completeDigest, SHA384_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testSha512WithEverything()
{
    int retVal = 0;
    sbyte4 compare = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] =
    {
        0x4c,0x4c,0xf0,0xf8,0xd3,0xa8,0x2c,0xc3,0xff,0x87,0xd1,0x4d,0xfc,0x39,0xbf,0x25,
        0x00,0x58,0x54,0xa1,0xd2,0x45,0x7f,0xd2,0x88,0xa5,0xbf,0x82,0x02,0xe3,0x0a,0xbb,
    };
    
    ubyte pNonce[16] = {0x42,0xc8,0x98,0x8c,0xc3,0x2a,0x86,0x0e,0x75,0x51,0xf7,0x66,0x90,0x24,0x8b,0x8a};
    
    ubyte pPersonalization[32] =
    {
        0x72,0x71,0xad,0xaa,0x5c,0x5e,0xaf,0x3a,0x25,0xb0,0xfe,0x97,0x2b,0x5d,0x2d,0x75,
        0x41,0x78,0xfa,0xf6,0x30,0x47,0xbc,0xc0,0xe0,0x60,0x0c,0xa9,0x4c,0x24,0x01,0x17,
    };
    
    ubyte pEntropyPR1[32] =
    {
        0x1f,0x2b,0x80,0xa1,0xa9,0xcf,0xbc,0xdc,0x8b,0xd7,0xff,0xe3,0x1a,0x21,0x71,0xf2,
        0x00,0x93,0xac,0x32,0xeb,0x9f,0x3c,0x1f,0x76,0xca,0xf3,0xa2,0x19,0x84,0x95,0xec,
    };
    
    ubyte pAdditionalInput1[32] =
    {
        0x09,0x67,0x56,0x87,0xd8,0xdc,0xa3,0x95,0x38,0xff,0x86,0xee,0xb2,0xa2,0x36,0x4f,
        0xa1,0x30,0xab,0xb6,0xc8,0x2a,0x62,0xb1,0x08,0x12,0xc3,0x17,0x78,0xe3,0x37,0x6c,
    };
    
    ubyte pEntropyPR2[32] =
    {
        0x2a,0xa8,0xa4,0x47,0xd2,0x06,0x94,0x1e,0x33,0x46,0x73,0x34,0x11,0x40,0x99,0x8d,
        0x61,0x3c,0x31,0x7b,0x69,0xd9,0x19,0x3f,0x30,0xcd,0xb4,0x3c,0x68,0x1c,0xa9,0x40,
    };
    
    ubyte pAdditionalInput2[32] =
    {
        0x0d,0x5a,0x76,0x34,0x76,0xc5,0x98,0x13,0x85,0x8c,0x68,0x8c,0x39,0x2b,0x23,0xb9,
        0x1a,0x36,0x7c,0x41,0xb0,0x92,0xc4,0x86,0x6c,0x0e,0x80,0x37,0xfa,0x25,0x55,0xb6,
    };
    
    ubyte pOutput[256] = {0};
    
    ubyte pExpectedOutput[256] =
    {
        0x3f,0x56,0xdd,0xc5,0x15,0x08,0x77,0x8f,0xa0,0x57,0xfc,0xbe,0x2c,0x88,0xa9,0x03,
        0x6e,0x7d,0x9c,0x3f,0x5b,0x4c,0x72,0xa4,0xa3,0xb8,0x23,0xba,0x61,0x01,0xeb,0xaa,
        0x81,0xe2,0x87,0xdf,0x92,0xd6,0xd1,0x44,0x5a,0xd9,0x0d,0x54,0xa7,0xad,0xd3,0x06,
        0xbd,0x34,0xe1,0x9a,0x68,0x20,0x61,0xec,0x71,0xc5,0x60,0x5d,0x85,0x85,0x15,0xdf,
        0x0b,0x9e,0x92,0x3a,0x19,0xa2,0x90,0x75,0x98,0x00,0x29,0x7c,0xa2,0x7f,0x43,0xd0,
        0x68,0x9a,0x32,0x9e,0x07,0x0c,0x16,0xe9,0x1a,0xad,0xb1,0xf4,0xce,0xca,0x54,0x20,
        0xa5,0xab,0xa6,0xbf,0x08,0x0f,0xf8,0xf7,0x4c,0xd1,0xdd,0x09,0x94,0x90,0xc6,0x6a,
        0xcd,0x65,0xb4,0x14,0x29,0x62,0x7b,0x8f,0xfa,0xfd,0x0f,0x6a,0x62,0xec,0x60,0x32,
        0x8d,0x6c,0x7e,0xbe,0x24,0x41,0x95,0x53,0x61,0xa8,0x09,0x33,0x6a,0xfa,0xbf,0xf6,
        0xdc,0x2a,0x37,0xcc,0xe8,0x01,0x66,0xd3,0x76,0x07,0xe0,0x4c,0xed,0xa3,0x7f,0x2b,
        0xa8,0x68,0x66,0x82,0x0d,0xb4,0xd1,0x51,0x8a,0x75,0x44,0x9c,0xa0,0xa9,0xf9,0x18,
        0x2a,0xe7,0x32,0x9f,0xb1,0x01,0x6e,0x5a,0xc9,0x23,0x51,0x62,0x42,0x69,0x4d,0x57,
        0x28,0x49,0x39,0x77,0x08,0xb6,0xfc,0xa1,0xd0,0xd7,0xeb,0xb7,0xbb,0x1f,0x2d,0x5a,
        0x2e,0xd3,0xd7,0x82,0x41,0x61,0xa7,0xd4,0xac,0x47,0x3b,0xda,0x26,0x60,0xfc,0x07,
        0xe0,0xde,0x86,0x44,0x21,0xdd,0xee,0x52,0x16,0x2d,0x3a,0x10,0x88,0xb5,0x73,0x9e,
        0x3b,0xa3,0xe7,0xe4,0xb8,0xa0,0xf1,0x6b,0x0f,0x61,0x9f,0x15,0x71,0x90,0xd5,0x25,
    };
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), pPersonalization,
                                            sizeof(pPersonalization), (DrbgHashMethod) &SHA512_completeDigest, SHA512_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR1, sizeof(pEntropyPR1), pAdditionalInput1, sizeof(pAdditionalInput1));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropyPR2, sizeof(pEntropyPR2), pAdditionalInput2, sizeof(pAdditionalInput2));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    status = DIGI_MEMCMP(pOutput, pExpectedOutput, sizeof(pOutput), &compare);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    retVal += UNITTEST_INT(__MOC_LINE__, compare, 0);
    
exit:
    
    if (NULL != pRandom)
    {
        status = NIST_HASHDRBG_deleteContext(&pRandom);
        retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    }
    
    return retVal;
}

/*****************************************************************************/

static int testErrorCases()
{
    int retVal = 0;
    MSTATUS status;
    
    ubyte pEntropy[32] = {0};
    ubyte pNonce[16] = {0};
    ubyte pOutput[32] = {0};
    
    NIST_HASH_DRBG_Ctx *pRandom = NULL;
    NIST_HASH_DRBG_Ctx unalloc = {0};
    
    /******* NIST_HASHDRBG_newSeededContext *******/
    
    /* null params */
    status = NIST_HASHDRBG_newSeededContext(NULL, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);

    status = NIST_HASHDRBG_newSeededContext(&pRandom, NULL, 0, pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, NULL, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    /* invalid hashOutLenBytes */
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, 19);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_DF_BAD_OUTPUT_LEN);
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, 21);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_DF_BAD_OUTPUT_LEN);

    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, 31);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_DF_BAD_OUTPUT_LEN);
    
    /* invalid entropy (seed) length */
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, 0, pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_ENTROPY_INPUT_LEN);
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, SHA256_RESULT_SIZE - 1, pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_ENTROPY_INPUT_LEN);
    
    /* invalid nonce len (0 is valid, otherwise must be at least securityStrength/2) */
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, 1, NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_NONCE_INPUT_LEN);
    
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, 15, NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_NONCE_INPUT_LEN);
    
    /* correctly instantiate for further tests */
    status = NIST_HASHDRBG_newSeededContext(&pRandom, pEntropy, sizeof(pEntropy), pNonce, sizeof(pNonce), NULL,
                                            0, (DrbgHashMethod) &SHA256_completeDigest, SHA256_RESULT_SIZE);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    if (OK != status)
        goto exit;
    
    /******* NIST_HASHDRBG_reSeed *******/
    
    /* null params */
    status = NIST_HASHDRBG_reSeed(NULL, pEntropy, sizeof(pEntropy), NULL, 0);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    status = NIST_HASHDRBG_reSeed(pRandom, NULL, sizeof(pEntropy), NULL, 0);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropy, sizeof(pEntropy), NULL, 1);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
     /* invalid entropy (seed) length */
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropy, 0, NULL, 0);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_ENTROPY_INPUT_LEN);
    
    status = NIST_HASHDRBG_reSeed(pRandom, pEntropy, SHA256_RESULT_SIZE - 1, NULL, 0);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_BAD_ENTROPY_INPUT_LEN);
    
    /* uninstantiated ctx */
    status = NIST_HASHDRBG_reSeed(&unalloc, pEntropy, sizeof(pEntropy), NULL, 0);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_UNINITIALIZED_CTX);
    
    /******* NIST_HASHDRBG_generate *******/
    
    /* null params */
    status = NIST_HASHDRBG_generate(NULL, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, NULL, sizeof(pOutput));
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
    /* uninstantiated ctx */
    status = NIST_HASHDRBG_generate(&unalloc, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_HASH_UNINITIALIZED_CTX);
    
    /* Test outputLenBytes = 0 which is a valid call */
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, NULL, 0);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    /* Test reseed needed, manually set counter since 2^48 calls is too long to test  */
    pRandom->pReseedCtr[1] = 0x01;
    status = NIST_HASHDRBG_generate(pRandom, NULL, 0, pOutput, sizeof(pOutput));
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NIST_RNG_DBRG_RESEED_NEEDED);
    
    /******* NIST_HASHDRBG_deleteContext *******/
    
    status = NIST_HASHDRBG_deleteContext(NULL);
    retVal += UNITTEST_INT(__MOC_LINE__, status, ERR_NULL_POINTER);
    
exit:
    
    /* properly delete the context */
    status = NIST_HASHDRBG_deleteContext(&pRandom);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    /* deleting an already deleted ctx is a valid call */
    status = NIST_HASHDRBG_deleteContext(&pRandom);
    retVal += UNITTEST_STATUS(__MOC_LINE__, status);
    
    return retVal;
}
#endif /* __ENABLE_DIGICERT_NIST_DRBG_HASH__ */

/*****************************************************************************/

int nist_drbg_hash_unit_test_all()
{
    int retVal = 0;

#ifdef __ENABLE_DIGICERT_NIST_DRBG_HASH__

    retVal += testSha1Simple();
    
    retVal += testSha224Simple();
    
    retVal += testSha256Simple();
    
    retVal += testSha384Simple();
    
    retVal += testSha512Simple();
    
    retVal += testSha1withPs();
    
    retVal += testSha1withAddInput();
    
    retVal += testSha1withPSandAddInput();
    
    retVal += testSha1AddEntropy();
    
    retVal += testSha224AddEntropy();
    
    retVal += testSha256AddEntropy();
    
    retVal += testSha1WithEverything();
    
    retVal += testSha224WithEverything();
    
    retVal += testSha256WithEverything();
    
   /* retVal += testSha512_224WithEverything();
    
      retVal += testSha512_256WithEverything();*/
    
    retVal += testSha384WithEverything();
    
    retVal += testSha512WithEverything();
    
    retVal += testErrorCases();

#endif /* __ENABLE_DIGICERT_NIST_DRBG_HASH__ */
    
    return retVal;
}
