26a27,28
> my $test_moc_ossl = !disabled("moc-ossl-v3-test");
> 
43a46,57
> if ($test_moc_ossl)
> {
>     @legacyprov = ("-provider-path", $provpath,
>                   "-provider", "digi",
>                   "-provider", "base",
>                   "-provider", "legacy" );
>     @defaultprov = ("-provider-path", $provpath,
>                    "-provider", "digi",
>                    "-provider", "base");
>     $provname = 'digi';
> }
> 
66a81,85
> if ($test_moc_ossl)
> {
>     push(@prov, "-provider", "base");
> }
> 
518,527d536
<     [ "signed content test streaming PEM format, RSA keys, PSS signature, SHA384 MGF1",
<       [ "{cmd1}", @prov, "-sign", "-in", $smcont, "-outform", "PEM", "-nodetach",
<         "-signer", $smrsa1,
<         "-keyopt", "rsa_padding_mode:pss", "-keyopt", "rsa_mgf1_md:sha384",
<         "-out", "{output}.cms" ],
<       [ "{cmd2}", @prov, "-verify", "-in", "{output}.cms", "-inform", "PEM",
<         "-CAfile", $smroot, "-out", "{output}.txt" ],
<       \&final_compare
<     ],
< 
561c570
<     [ "enveloped content test streaming S/MIME format, DES, OAEP SHA256",
---
>     [ "enveloped content test streaming S/MIME format, DES, OAEP SHA1",
566c575
<         "-keyopt", "rsa_oaep_md:sha256" ],
---
>         "-keyopt", "rsa_oaep_md:sha1" ],
572,599d580
<     [ "enveloped content test streaming S/MIME format, DES, ECDH",
<       [ "{cmd1}", @defaultprov, "-encrypt", "-in", $smcont,
<         "-stream", "-out", "{output}.cms",
<         "-recip", catfile($smdir, "smec1.pem") ],
<       [ "{cmd2}", @defaultprov, "-decrypt", "-recip", catfile($smdir, "smec1.pem"),
<         "-in", "{output}.cms", "-out", "{output}.txt" ],
<       \&final_compare
<     ],
< 
<     [ "enveloped content test streaming S/MIME format, DES, ECDH, 2 recipients, key only used",
<       [ "{cmd1}", @defaultprov, "-encrypt", "-in", $smcont,
<         "-stream", "-out", "{output}.cms",
<         catfile($smdir, "smec1.pem"),
<         catfile($smdir, "smec3.pem") ],
<       [ "{cmd2}", @defaultprov, "-decrypt", "-inkey", catfile($smdir, "smec3.pem"),
<         "-in", "{output}.cms", "-out", "{output}.txt" ],
<       \&final_compare
<     ],
< 
<     [ "enveloped content test streaming S/MIME format, ECDH, DES, key identifier",
<       [ "{cmd1}", @defaultprov, "-encrypt", "-keyid", "-in", $smcont,
<         "-stream", "-out", "{output}.cms",
<         "-recip", catfile($smdir, "smec1.pem") ],
<       [ "{cmd2}", @defaultprov, "-decrypt", "-recip", catfile($smdir, "smec1.pem"),
<         "-in", "{output}.cms", "-out", "{output}.txt" ],
<       \&final_compare
<     ],
< 
617,635d597
<     ],
< 
<     [ "enveloped content test streaming S/MIME format, ECDH, K-283, cofactor DH",
<       [ "{cmd1}", @prov, "-encrypt", "-in", $smcont,
<         "-stream", "-out", "{output}.cms",
<         "-recip", catfile($smdir, "smec2.pem"), "-aes128",
<         "-keyopt", "ecdh_kdf_md:sha256", "-keyopt", "ecdh_cofactor_mode:1" ],
<       [ "{cmd2}", @prov, "-decrypt", "-recip", catfile($smdir, "smec2.pem"),
<         "-in", "{output}.cms", "-out", "{output}.txt" ],
<       \&final_compare
<     ],
< 
<     [ "enveloped content test streaming S/MIME format, X9.42 DH",
<       [ "{cmd1}", @prov, "-encrypt", "-in", $smcont,
<         "-stream", "-out", "{output}.cms",
<         "-recip", catfile($smdir, "smdh.pem"), "-aes128" ],
<       [ "{cmd2}", @prov, "-decrypt", "-recip", catfile($smdir, "smdh.pem"),
<         "-in", "{output}.cms", "-out", "{output}.txt" ],
<       \&final_compare
861,862c823,824
<         skip "EC or DES isn't supported in this build", 1
<             if disabled("ec") || disabled("des");
---
>         skip "3DES keywrap isn't supported in this build", 1
>             if 1;
864,871d825
<         my $out = "smtst.txt";
< 
<         ok(run(app(["openssl", "cms", @defaultprov, "-decrypt",
<                     "-inkey", catfile($smdir, "smec3.pem"),
<                     "-in", catfile($datadir, "ciphertext_from_1_1_1.cms"),
<                     "-out", $out ]))
<            && compare_text($smcont, $out) == 0,
<            "Decrypt message from OpenSSL 1.1.1");
