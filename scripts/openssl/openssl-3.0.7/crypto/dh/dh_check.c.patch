146c146
<     int ok = 0, r;
---
>     int ok = 0, r, q_good = 0;
154a155,160
>     /* Don't do any checks at all with an excessively large modulus */
>     if (BN_num_bits(dh->params.p) > OPENSSL_DH_CHECK_MAX_MODULUS_BITS) {
>         ERR_raise(ERR_LIB_DH, DH_R_MODULUS_TOO_LARGE);
>         return 0;
>     }
> 
167a174,180
>         if (BN_ucmp(dh->params.p, dh->params.q) > 0)
>             q_good = 1;
>         else
>             *ret |= DH_CHECK_INVALID_Q_VALUE;
>     }
> 
>     if (q_good) {
